# ç¯å¢ƒé…ç½®è‡ªåŠ¨åˆ‡æ¢æŒ‡å—

## é—®é¢˜æè¿°

æ¯æ¬¡åˆ‡æ¢å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š
```yaml
# å¾®ä¿¡å›è°ƒåœ°å€
# callback: http://10xh9vd648325.vicp.fun  # å¼€å‘ç¯å¢ƒ
callback: https://paperback.zww0891.fun    # ç”Ÿäº§ç¯å¢ƒ

# æ–‡ä»¶ä¸Šä¼ è·¯å¾„
# profile: D:/ruoyi/uploadPath              # å¼€å‘ç¯å¢ƒï¼ˆWindowsï¼‰
profile: /home/ruoyi/uploadPath             # ç”Ÿäº§ç¯å¢ƒï¼ˆLinuxï¼‰

# æ•°æ®åº“é…ç½®
username: root
password: damingPaper123456
```

**å¤ªéº»çƒ¦äº†ï¼æ¯æ¬¡éƒ½è¦æ”¹æ¥æ”¹å»ã€‚**

---

## è§£å†³æ–¹æ¡ˆï¼šSpring Boot Profile

ä½¿ç”¨ Spring Boot çš„ **Profile æœºåˆ¶**ï¼Œå®ç°ç¯å¢ƒé…ç½®è‡ªåŠ¨åˆ‡æ¢ã€‚

### æ–¹æ¡ˆæ¶æ„

```
application.yml           # ä¸»é…ç½®æ–‡ä»¶ï¼ˆå…¬å…±é…ç½®ï¼‰
â”œâ”€â”€ application-dev.yml   # å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆè‡ªåŠ¨è¦†ç›–ï¼‰
â””â”€â”€ application-prod.yml  # ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆè‡ªåŠ¨è¦†ç›–ï¼‰
```

**åŸç†**ï¼š
- å¯åŠ¨æ—¶æŒ‡å®š `--spring.profiles.active=dev` æˆ– `prod`
- Spring Boot è‡ªåŠ¨åŠ è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶
- **æ— éœ€æ‰‹åŠ¨ä¿®æ”¹ä»»ä½•é…ç½®ï¼**

---

## ä¸€ã€é…ç½®æ–‡ä»¶è¯´æ˜

### 1. application.ymlï¼ˆä¸»é…ç½®ï¼‰

**ä½œç”¨**ï¼šå­˜æ”¾æ‰€æœ‰ç¯å¢ƒçš„å…¬å…±é…ç½®

**å†…å®¹**ï¼š
```yaml
# æœåŠ¡å™¨ç«¯å£
server:
  port: 8080

# å¾®ä¿¡å…¬ä¼—å·é…ç½®ï¼ˆå…¬å…±éƒ¨åˆ†ï¼‰
wx:
  mp:
    enabled: true
    configs:
      - appId: wxeac644b6acef0405
        secret: 22681f0abf2490d0853b5675905b557b
        token: b3337731ab0711ef8c1fe79208535f88
        aesKey: Hha4Su7QiNUEdj1jow5oQZtcIXVshfUXSClXRCpD1am

# æ•°æ®åº“é…ç½®ï¼ˆå…¬å…±éƒ¨åˆ†ï¼‰
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/ry-vue?useUnicode=true&characterEncoding=utf8&...
```

**æ³¨æ„**ï¼šåªä¿ç•™å…¬å…±é…ç½®ï¼Œç¯å¢ƒç›¸å…³çš„é…ç½®ç§»åˆ°å¯¹åº”çš„ profile æ–‡ä»¶ã€‚

---

### 2. application-dev.ymlï¼ˆå¼€å‘ç¯å¢ƒï¼‰

**ä½œç”¨**ï¼šå¼€å‘ç¯å¢ƒçš„ç‰¹æœ‰é…ç½®

**å†…å®¹**ï¼š
```yaml
# å¾®ä¿¡å…¬ä¼—å·é…ç½® - å¼€å‘ç¯å¢ƒ
wx:
  mp:
    callback: http://10xh9vd648325.vicp.fun  # å†…ç½‘ç©¿é€åŸŸå
    authScope: base

# æ–‡ä»¶ä¸Šä¼ è·¯å¾„ - å¼€å‘ç¯å¢ƒï¼ˆWindowsï¼‰
ruoyi:
  profile: D:/ruoyi/uploadPath

# æ•°æ®åº“é…ç½® - å¼€å‘ç¯å¢ƒ
spring:
  datasource:
    druid:
      master:
        username: root
        password: damingPaper123456
```

**æ–‡ä»¶è·¯å¾„**ï¼š`ruoyi-admin/src/main/resources/application-dev.yml`

---

### 3. application-prod.ymlï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**ä½œç”¨**ï¼šç”Ÿäº§ç¯å¢ƒçš„ç‰¹æœ‰é…ç½®

**å†…å®¹**ï¼š
```yaml
# å¾®ä¿¡å…¬ä¼—å·é…ç½® - ç”Ÿäº§ç¯å¢ƒ
wx:
  mp:
    callback: https://paperback.zww0891.fun  # çº¿ä¸ŠåŸŸå
    authScope: base

# æ–‡ä»¶ä¸Šä¼ è·¯å¾„ - ç”Ÿäº§ç¯å¢ƒï¼ˆLinuxï¼‰
ruoyi:
  profile: /home/ruoyi/uploadPath

# æ•°æ®åº“é…ç½® - ç”Ÿäº§ç¯å¢ƒ
spring:
  datasource:
    druid:
      master:
        username: root
        password: damingPaper123456
```

**æ–‡ä»¶è·¯å¾„**ï¼š`ruoyi-admin/src/main/resources/application-prod.yml`

---

## äºŒã€å¯åŠ¨æ–¹å¼

### æ–¹å¼1ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰â­

#### Windows å¼€å‘ç¯å¢ƒ
```bash
# åŒå‡»è¿è¡Œ
bin/run-dev.bat

# æˆ–åœ¨ IDEA ä¸­é…ç½® Active profiles: dev
```

#### Linux ç”Ÿäº§ç¯å¢ƒ
```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x bin/run-prod.sh

# å¯åŠ¨
./bin/run-prod.sh

# æˆ–è€…
bash bin/run-prod.sh
```

---

### æ–¹å¼2ï¼šå‘½ä»¤è¡Œå¯åŠ¨

#### å¼€å‘ç¯å¢ƒ
```bash
java -jar ruoyi-admin.jar --spring.profiles.active=dev
```

#### ç”Ÿäº§ç¯å¢ƒ
```bash
java -jar ruoyi-admin.jar --spring.profiles.active=prod
```

---

### æ–¹å¼3ï¼šIDEA é…ç½®

1. æ‰“å¼€ Run/Debug Configurations
2. æ‰¾åˆ° Spring Boot å¯åŠ¨é¡¹
3. åœ¨ **Active profiles** ä¸­å¡«å…¥ï¼š`dev`
4. ç‚¹å‡» OK

**æ•ˆæœ**ï¼šç›´æ¥ç‚¹å‡»è¿è¡ŒæŒ‰é’®å³å¯å¯åŠ¨å¼€å‘ç¯å¢ƒ

---

## ä¸‰ã€å®Œæ•´å¯åŠ¨æµç¨‹

### å¼€å‘ç¯å¢ƒï¼ˆæœ¬åœ° Windowsï¼‰

**æ­¥éª¤**ï¼š
```bash
# 1. æ‰“åŒ…ï¼ˆå¯é€‰ï¼‰
mvn clean package -DskipTests

# 2. å¯åŠ¨å¼€å‘ç¯å¢ƒ
bin\run-dev.bat

# 3. éªŒè¯
è®¿é—®ï¼šhttp://localhost:8080
å¾®ä¿¡å›è°ƒï¼šhttp://10xh9vd648325.vicp.fun/wx/portal/public
```

**è‡ªåŠ¨ä½¿ç”¨çš„é…ç½®**ï¼š
- âœ… `callback: http://10xh9vd648325.vicp.fun`
- âœ… `profile: D:/ruoyi/uploadPath`
- âœ… `password: damingPaper123456`

---

### ç”Ÿäº§ç¯å¢ƒï¼ˆæœåŠ¡å™¨ Linuxï¼‰

**æ­¥éª¤**ï¼š
```bash
# 1. ä¸Šä¼  jar åŒ…
scp ruoyi-admin/target/ruoyi-admin.jar root@server:/opt/app/

# 2. ä¸Šä¼ å¯åŠ¨è„šæœ¬
scp bin/run-prod.sh root@server:/opt/app/

# 3. ç™»å½•æœåŠ¡å™¨
ssh root@server

# 4. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x /opt/app/run-prod.sh

# 5. å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
cd /opt/app
./run-prod.sh

# 6. æŸ¥çœ‹æ—¥å¿—
tail -f /opt/app/logs/ruoyi-admin.log

# 7. éªŒè¯
è®¿é—®ï¼šhttps://paperback.zww0891.fun
å¾®ä¿¡å›è°ƒï¼šhttps://paperback.zww0891.fun/wx/portal/public
```

**è‡ªåŠ¨ä½¿ç”¨çš„é…ç½®**ï¼š
- âœ… `callback: https://paperback.zww0891.fun`
- âœ… `profile: /home/ruoyi/uploadPath`
- âœ… `password: damingPaper123456`

---

## å››ã€éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ

### æ–¹æ³•1ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—

**å¼€å‘ç¯å¢ƒ**ï¼š
```log
The following profiles are active: dev
å¾®ä¿¡å…¬ä¼—å·é…ç½® - callback: http://10xh9vd648325.vicp.fun
```

**ç”Ÿäº§ç¯å¢ƒ**ï¼š
```log
The following profiles are active: prod
å¾®ä¿¡å…¬ä¼—å·é…ç½® - callback: https://paperback.zww0891.fun
```

### æ–¹æ³•2ï¼šè®¿é—®æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•åç«¯æ˜¯å¦æ­£å¸¸
curl http://localhost:8080/test/ping

# æµ‹è¯•å¾®ä¿¡å›è°ƒåœ°å€
å¼€å‘ç¯å¢ƒï¼šhttp://10xh9vd648325.vicp.fun/wx/portal/public
ç”Ÿäº§ç¯å¢ƒï¼šhttps://paperback.zww0891.fun/wx/portal/public
```

---

## äº”ã€å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ï¼Œä½†ä¸ç”Ÿæ•ˆï¼Ÿ
**A**: éœ€è¦é‡æ–°æ‰“åŒ…å¹¶é‡å¯åº”ç”¨ã€‚

```bash
# 1. é‡æ–°æ‰“åŒ…
mvn clean package -DskipTests

# 2. é‡å¯
# å¼€å‘ç¯å¢ƒ
bin\run-dev.bat

# ç”Ÿäº§ç¯å¢ƒ
./bin/run-prod.sh
```

---

### Q2: å¦‚ä½•ç¡®è®¤å½“å‰ä½¿ç”¨çš„æ˜¯å“ªä¸ªç¯å¢ƒï¼Ÿ
**A**: æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„ `The following profiles are active: xxx`

```bash
# å¼€å‘ç¯å¢ƒ
tail -f logs/spring.log | grep "profiles are active"
# è¾“å‡º: The following profiles are active: dev

# ç”Ÿäº§ç¯å¢ƒ
tail -f /opt/app/logs/ruoyi-admin.log | grep "profiles are active"
# è¾“å‡º: The following profiles are active: prod
```

---

### Q3: å¯ä»¥åœ¨ application.yml ä¸­è®¾ç½®é»˜è®¤ profile å—ï¼Ÿ
**A**: å¯ä»¥ï¼Œä½†**ä¸æ¨è**ã€‚å»ºè®®åœ¨å¯åŠ¨æ—¶æ˜ç¡®æŒ‡å®šã€‚

```yaml
# application.yml
spring:
  profiles:
    active: dev  # é»˜è®¤ä½¿ç”¨ dev ç¯å¢ƒï¼ˆä¸æ¨èï¼‰
```

**æ¨èåšæ³•**ï¼šå¯åŠ¨æ—¶æ˜ç¡®æŒ‡å®šï¼Œé¿å…è¯¯æ“ä½œã€‚

---

### Q4: ç”Ÿäº§ç¯å¢ƒçš„å¯†ç å¯ä»¥æ›´å®‰å…¨å—ï¼Ÿ
**A**: å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®ä¸­å¿ƒï¼ˆNacosï¼‰ã€‚

**æ–¹æ³•1ï¼šç¯å¢ƒå˜é‡**
```bash
# å¯åŠ¨æ—¶æŒ‡å®š
java -jar ruoyi-admin.jar \
  --spring.profiles.active=prod \
  --spring.datasource.druid.master.password=${DB_PASSWORD}

# æˆ–è®¾ç½®ç¯å¢ƒå˜é‡
export DB_PASSWORD=damingPaper123456
java -jar ruoyi-admin.jar --spring.profiles.active=prod
```

**æ–¹æ³•2ï¼šJasypt åŠ å¯†**
```yaml
# application-prod.yml
spring:
  datasource:
    druid:
      master:
        password: ENC(åŠ å¯†åçš„å¯†ç )
```

---

### Q5: å¦‚ä½•æ·»åŠ æµ‹è¯•ç¯å¢ƒï¼Ÿ
**A**: åˆ›å»º `application-test.yml`

```yaml
# application-test.yml
wx:
  mp:
    callback: http://test.paperback.zww0891.fun
ruoyi:
  profile: /home/ruoyi/test/uploadPath
```

å¯åŠ¨æ—¶æŒ‡å®šï¼š
```bash
java -jar ruoyi-admin.jar --spring.profiles.active=test
```

---

## å…­ã€ç›®å½•ç»“æ„

```
daming-admin/
â”œâ”€â”€ bin/
â”‚   â”œâ”€â”€ run-dev.bat          # Windows å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ run-prod.sh          # Linux ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”œâ”€â”€ ruoyi-admin/
â”‚   â””â”€â”€ src/main/resources/
â”‚       â”œâ”€â”€ application.yml       # ä¸»é…ç½®ï¼ˆå…¬å…±ï¼‰
â”‚       â”œâ”€â”€ application-dev.yml   # å¼€å‘ç¯å¢ƒé…ç½® â­
â”‚       â””â”€â”€ application-prod.yml  # ç”Ÿäº§ç¯å¢ƒé…ç½® â­
â””â”€â”€ doc/
    â””â”€â”€ ç¯å¢ƒé…ç½®åˆ‡æ¢æŒ‡å—.md  # æœ¬æ–‡æ¡£
```

---

## ä¸ƒã€æ€»ç»“

### ä¼˜ç‚¹
âœ… **æ— éœ€æ‰‹åŠ¨ä¿®æ”¹é…ç½®**  
âœ… **å¯åŠ¨æ—¶è‡ªåŠ¨åˆ‡æ¢**  
âœ… **é™ä½äººä¸ºé”™è¯¯**  
âœ… **é…ç½®æ¸…æ™°æ˜äº†**  
âœ… **ä¾¿äºå›¢é˜Ÿåä½œ**

### åˆ‡æ¢å¯¹ç…§è¡¨

| åœºæ™¯ | å¯åŠ¨å‘½ä»¤ | è‡ªåŠ¨ä½¿ç”¨çš„é…ç½® |
|------|---------|--------------|
| æœ¬åœ°å¼€å‘ | `bin\run-dev.bat` | application-dev.yml |
| æœåŠ¡å™¨éƒ¨ç½² | `./bin/run-prod.sh` | application-prod.yml |
| IDEA è°ƒè¯• | Active profiles: dev | application-dev.yml |
| æµ‹è¯•ç¯å¢ƒ | `--spring.profiles.active=test` | application-test.yml |

---

## å…«ã€å¿«é€Ÿä¸Šæ‰‹

**ç¬¬ä¸€æ¬¡ä½¿ç”¨**ï¼š
```bash
# 1. ç¡®ä¿é…ç½®æ–‡ä»¶å·²åˆ›å»º
ruoyi-admin/src/main/resources/application-dev.yml  âœ…
ruoyi-admin/src/main/resources/application-prod.yml âœ…

# 2. å¼€å‘ç¯å¢ƒå¯åŠ¨
bin\run-dev.bat

# 3. ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
./bin/run-prod.sh
```

**ä»¥ååˆ‡æ¢**ï¼š
- å¼€å‘ â†’ ç”Ÿäº§ï¼šåªéœ€è¿è¡Œ `./bin/run-prod.sh`
- ç”Ÿäº§ â†’ å¼€å‘ï¼šåªéœ€è¿è¡Œ `bin\run-dev.bat`

**å®Œå…¨ä¸ç”¨æ”¹é…ç½®æ–‡ä»¶ï¼** ğŸ‰
