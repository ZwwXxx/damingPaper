# 论坛功能开发文档

> 开发时间：2025-11-23
> 功能描述：实现类似百度贴吧的论坛功能，鸿蒙风格UI

---

## 一、功能特性

### 1.1 核心功能
- ✅ **帖子管理**：发帖、浏览、编辑、删除
- ✅ **评论功能**：发表评论、回复评论、嵌套评论
- ✅ **点赞功能**：帖子点赞、评论点赞
- ✅ **权限控制**：游客可浏览，登录后可发帖/评论/点赞
- ✅ **数据统计**：浏览次数、点赞数、评论数

### 1.2 UI设计风格
- 🎨 **鸿蒙设计语言**：简洁、大气、极简
- 🎨 **配色方案**：青绿色主题 (#1ac89a)
- 🎨 **卡片式布局**：圆角、阴影、玻璃态
- 🎨 **流畅动画**：过渡效果、悬停效果

---

## 二、数据库设计

### 2.1 执行SQL

**位置：** `daming-admin/sql/2025-11-23/1-forum-tables.sql`

**包含表：**
1. `forum_post` - 帖子表
2. `forum_comment` - 评论表
3. `forum_like` - 点赞表

**执行步骤：**
```sql
-- 1. 连接数据库
USE your_database_name;

-- 2. 执行SQL文件
SOURCE /path/to/1-forum-tables.sql;

-- 3. 验证表创建
SHOW TABLES LIKE 'forum_%';
```

### 2.2 表结构说明

#### forum_post（帖子表）
| 字段 | 类型 | 说明 |
|------|------|------|
| post_id | BIGINT | 帖子ID（主键） |
| user_id | BIGINT | 发帖人ID |
| title | VARCHAR(200) | 帖子标题 |
| content | TEXT | 帖子内容 |
| images | JSON | 图片列表 |
| view_count | INT | 浏览次数 |
| like_count | INT | 点赞数 |
| comment_count | INT | 评论数 |
| is_top | TINYINT | 是否置顶 |
| is_hot | TINYINT | 是否热门 |

#### forum_comment（评论表）
| 字段 | 类型 | 说明 |
|------|------|------|
| comment_id | BIGINT | 评论ID（主键） |
| post_id | BIGINT | 帖子ID |
| user_id | BIGINT | 评论人ID |
| content | TEXT | 评论内容 |
| parent_id | BIGINT | 父评论ID（回复用） |
| like_count | INT | 点赞数 |

#### forum_like（点赞表）
| 字段 | 类型 | 说明 |
|------|------|------|
| like_id | BIGINT | 点赞ID（主键） |
| user_id | BIGINT | 用户ID |
| target_id | BIGINT | 目标ID |
| target_type | TINYINT | 目标类型（1帖子 2评论） |

---

## 三、后端架构

### 3.1 项目结构
```
daming-admin/
├── ruoyi-common/
│   └── src/main/java/com/ruoyi/common/core/domain/entity/
│       ├── ForumPost.java          # 帖子实体类
│       ├── ForumComment.java       # 评论实体类
│       └── ForumLike.java          # 点赞实体类
├── dm_questionBank/
│   ├── src/main/java/com/ruoyi/quiz/mapper/
│   │   ├── ForumPostMapper.java    # 帖子Mapper接口
│   │   ├── ForumCommentMapper.java # 评论Mapper接口
│   │   └── ForumLikeMapper.java    # 点赞Mapper接口
│   ├── src/main/java/com/ruoyi/quiz/service/
│   │   ├── IForumService.java          # 论坛服务接口
│   │   └── impl/ForumServiceImpl.java  # 论坛服务实现
│   └── src/main/resources/mapper/quiz/
│       ├── ForumPostMapper.xml     # 帖子SQL映射
│       ├── ForumCommentMapper.xml  # 评论SQL映射
│       └── ForumLikeMapper.xml     # 点赞SQL映射
└── ruoyi-admin/
    └── src/main/java/com/ruoyi/web/controller/quiz/student/
        └── ForumController.java    # 论坛控制器
```

### 3.2 API接口列表

#### 帖子接口
| 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|
| GET | `/quiz/forum/posts` | 匿名 | 查询帖子列表 |
| GET | `/quiz/forum/posts/{postId}` | 匿名 | 查询帖子详情 |
| POST | `/quiz/forum/posts` | 登录 | 发布帖子 |
| PUT | `/quiz/forum/posts/{postId}` | 登录 | 更新帖子 |
| DELETE | `/quiz/forum/posts/{postId}` | 登录 | 删除帖子 |

#### 评论接口
| 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|
| GET | `/quiz/forum/posts/{postId}/comments` | 匿名 | 查询评论列表 |
| POST | `/quiz/forum/comments` | 登录 | 发表评论 |
| DELETE | `/quiz/forum/comments/{commentId}` | 登录 | 删除评论 |

#### 点赞接口
| 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|
| POST | `/quiz/forum/posts/{postId}/like` | 登录 | 点赞/取消点赞帖子 |
| POST | `/quiz/forum/comments/{commentId}/like` | 登录 | 点赞/取消点赞评论 |

---

## 四、前端实现

### 4.1 目录结构（待创建）
```
daming-front/
├── src/
│   ├── api/
│   │   └── forum.js               # 论坛API封装 ✅ 已创建
│   └── views/
│       └── forum/
│           ├── index.vue          # 帖子列表页（待创建）
│           ├── detail.vue         # 帖子详情页（待创建）
│           └── post.vue           # 发帖页面（待创建）
```

### 4.2 路由配置（待添加）
```javascript
// router/index.js
{
  path: '/forum',
  component: Layout,
  children: [
    {
      path: 'index',
      name: 'ForumIndex',
      component: () => import('@/views/forum/index'),
      meta: { title: '论坛' }
    },
    {
      path: 'detail/:id',
      name: 'ForumDetail',
      component: () => import('@/views/forum/detail'),
      meta: { title: '帖子详情' }
    },
    {
      path: 'post',
      name: 'ForumPost',
      component: () => import('@/views/forum/post'),
      meta: { title: '发帖', requireAuth: true }
    }
  ]
}
```

---

## 五、测试步骤

### 5.1 后端测试

1. **启动后端服务**
   ```bash
   cd daming-admin
   mvn clean package
   java -jar ruoyi-admin/target/ruoyi-admin.jar
   ```

2. **测试接口**（使用Postman或Apifox）
   
   **获取帖子列表**
   ```
   GET http://localhost:8080/quiz/forum/posts
   ```
   
   **发布帖子**（需要登录Token）
   ```
   POST http://localhost:8080/quiz/forum/posts
   Header: Authorization: Bearer {token}
   Body: {
     "title": "测试帖子",
     "content": "这是测试内容",
     "images": []
   }
   ```

### 5.2 前端测试

1. **安装依赖并启动**
   ```bash
   cd daming-front
   npm install
   npm run dev
   ```

2. **访问论坛**
   ```
   http://localhost:9528/forum/index
   ```

---

## 六、已完成功能

### ✅ 后端部分
- [x] 数据库表设计和创建
- [x] 实体类创建（ForumPost、ForumComment、ForumLike）
- [x] Mapper接口和XML映射
- [x] Service业务层实现
- [x] Controller接口层
- [x] Spring Security权限配置
- [x] 点赞状态批量查询优化
- [x] 评论树结构构建

### ✅ 前端部分
- [x] API封装（forum.js）

### ⏳ 待完成
- [ ] 论坛列表页面（鸿蒙风格UI）
- [ ] 帖子详情页面
- [ ] 发帖页面（支持富文本和图片上传）
- [ ] 路由配置
- [ ] 导航菜单添加论坛入口

---

## 七、核心功能说明

### 7.1 点赞机制
- 点赞采用toggle模式：点击一次点赞，再次点击取消
- 点赞状态实时同步到前端
- 使用`forum_like`表记录点赞关系，避免重复点赞
- 支持批量查询点赞状态，优化性能

### 7.2 评论树结构
- 支持两级评论（根评论 + 回复）
- 前端自动构建评论树
- parentId为null表示根评论
- parentId不为null表示回复某条评论

### 7.3 权限控制
- 游客：可以浏览帖子和评论
- 登录用户：可以发帖、评论、点赞
- 帖子作者：可以编辑和删除自己的帖子
- 评论作者：可以删除自己的评论

---

## 八、注意事项

1. **图片存储**
   - 帖子图片以JSON数组形式存储
   - 建议使用OSS存储图片
   - 前端上传图片后获取URL，再提交帖子

2. **性能优化**
   - 使用批量查询点赞状态，减少数据库查询
   - 帖子列表分页加载
   - 图片懒加载

3. **安全性**
   - 所有用户输入需要校验和过滤
   - 防止XSS攻击
   - 防止SQL注入

4. **扩展功能**（可选）
   - 帖子搜索
   - 帖子分类/标签
   - 举报功能
   - 收藏功能
   - @ 提醒功能

---

## 九、联系方式

如有问题，请查看：
- 后端日志：`daming-admin/logs/`
- 前端控制台：浏览器F12

祝开发顺利！🎉
