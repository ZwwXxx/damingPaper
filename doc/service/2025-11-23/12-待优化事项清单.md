# 待优化事项清单

## 📋 文档信息

- **创建日期**: 2025-11-23
- **版本**: v1.0
- **用途**: 记录待实现的功能优化和已知问题

---

## 🚧 待优化事项

### 1. 【中优先级】单题练习功能增强

**问题描述**：
- 当前`daming_question_answer`表缺少`do_time`字段
- 单独做题无法统计学习时长
- `UNION ALL`统计学习天数时，单题练习的时间价值未充分体现

**优化方案**：

#### 1.1 数据库修改
```sql
-- 给daming_question_answer表增加字段
ALTER TABLE `daming_question_answer` 
ADD COLUMN `do_time` INT(11) NULL DEFAULT NULL COMMENT '答题用时（秒）' 
AFTER `create_time`;

ALTER TABLE `daming_question_answer` 
ADD COLUMN `practice_type` TINYINT(4) NULL DEFAULT 0 COMMENT '练习类型：0-随机 1-错题 2-收藏 3-专项' 
AFTER `do_time`;
```

#### 1.2 paper_id语义扩展
```
paper_id > 0   → 正式试卷（组卷模式）
paper_id = 0   → 单题随机练习
paper_id = -1  → 错题本练习
paper_id = -2  → 收藏题练习
paper_id = -3  → 专项训练
```

#### 1.3 前端改造
- 做题页面增加计时器功能
- 提交答案时记录`do_time`
- 支持多种练习模式

#### 1.4 统计SQL优化
```sql
<!-- 累计学习时长（合并两张表） -->
<select id="getTotalStudyTime" resultType="java.lang.Long">
    SELECT IFNULL(SUM(study_minutes), 0) AS total_minutes
    FROM (
        -- 考试时间（分钟）
        SELECT do_time AS study_minutes 
        FROM daming_paper_answer 
        WHERE create_user = #{userId} AND do_time IS NOT NULL
        
        UNION ALL
        
        -- 单题练习时间（秒 → 分钟）
        SELECT FLOOR(do_time / 60) AS study_minutes 
        FROM daming_question_answer 
        WHERE create_user = #{userId} 
          AND do_time IS NOT NULL
          AND paper_id <= 0  -- 只统计练习模式，避免重复
    ) AS all_study_time
</select>
```

**收益**：
- 学习时长统计更完整
- `UNION ALL`统计更有意义
- 可以分析不同练习模式的效率
- 用户看到更全面的学习数据

---

### 2. 【低优先级】其他待优化项

（待补充...）

---

## ✅ 已完成优化

### 1. 后台用户数统计修复 ⭐
- **完成日期**: 2025-11-23
- **问题**: 只统计了sys_user表，缺少daming_user表
- **修复**: 合并两张表的用户数统计
- **相关文件**: 
  - `DashboardMapper.xml` (countTotalUsers, countNewUsers)
  - `sql/2025-11-23/1-修复用户数统计SQL变更.sql`
- **影响**: 用户总数更准确，包含管理员和学生用户

### 2. 考试成绩趋势按试卷分类
- **完成日期**: 2025-11-23
- **说明**: 增加试卷选择器，支持按试卷名称筛选成绩趋势
- **相关文档**: [按试卷分类统计优化说明.md](../2025-11-22/8-按试卷分类统计优化说明.md)

### 3. 删除科目成绩对比雷达图
- **完成日期**: 2025-11-23
- **说明**: 删除重复的科目成绩对比功能，优化页面布局

### 4. 删除考试成绩趋势的参考线
- **完成日期**: 2025-11-23
- **说明**: 删除及格线和优秀线，让图表更简洁

---

## 📅 优化优先级说明

- **高优先级**: 影响核心统计数据准确性，建议尽快修复
- **中优先级**: 功能增强类，可提升用户体验
- **低优先级**: 细节优化，可稍后处理

---

## 🔄 更新日志

| 日期 | 操作 | 说明 |
|------|------|------|
| 2025-11-23 | 创建文档 | 初始版本 |
| 2025-11-23 | 新增事项1 | 后台管理平台用户数统计问题 |
| 2025-11-23 | 新增事项2 | 单题练习功能增强 |
