# 反馈管理模块完整开发文档

## 📋 文档信息

- **创建日期**: 2025-11-23
- **模块名称**: 反馈管理系统
- **开发人员**: daming
- **版本**: v1.0

---

## 📝 功能概述

反馈管理系统包含后台管理和前台用户两部分，实现了用户反馈提交、管理员处理、双向沟通的完整闭环。

### 核心功能

#### 后台管理功能
1. **反馈列表管理** - 查询、筛选、分页展示
2. **反馈详情查看** - 查看用户提交的完整反馈信息
3. **反馈处理** - 更新状态、添加回复、设置优先级
4. **反馈删除** - 批量删除反馈记录
5. **数据统计** - 按状态、按类型统计
6. **数据导出** - 导出Excel

#### 前台用户功能
1. **提交反馈** - 填写反馈标题、内容、类型、联系方式
2. **我的反馈** - 查看自己提交的所有反馈
3. **查看回复** - 查看管理员的处理状态和回复内容
4. **删除反馈** - 删除待处理状态的反馈

---

## 🗄️ 数据库设计

### 表结构：`daming_feedback`

| 字段名 | 类型 | 说明 | 备注 |
|--------|------|------|------|
| feedback_id | bigint(20) | 反馈ID | 主键，自增 |
| user_id | varchar(64) | 用户ID | 必填 |
| user_name | varchar(64) | 用户名称 | 冗余字段 |
| feedback_type | tinyint(4) | 反馈类型 | 1=功能建议 2=Bug反馈 3=使用问题 4=其他 |
| feedback_title | varchar(200) | 反馈标题 | 必填 |
| feedback_content | text | 反馈内容 | 必填 |
| contact_info | varchar(200) | 联系方式 | 可选 |
| images | varchar(1000) | 截图附件 | 多个用逗号分隔 |
| status | tinyint(4) | 处理状态 | 0=待处理 1=处理中 2=已处理 3=已关闭 |
| priority | tinyint(4) | 优先级 | 1=低 2=中 3=高 |
| handler | varchar(64) | 处理人 | 管理员用户名 |
| handle_time | datetime | 处理时间 | 自动填充 |
| reply_content | text | 回复内容 | 管理员回复 |
| del_flag | char(1) | 删除标志 | 0=正常 1=删除 |

### 索引设计

```sql
-- 主键
PRIMARY KEY (feedback_id)

-- 用户ID索引 - 查询用户反馈
KEY idx_user_id (user_id)

-- 状态索引 - 筛选待处理反馈
KEY idx_status (status)

-- 创建时间索引 - 时间排序
KEY idx_create_time (create_time)

-- 类型索引 - 分类统计
KEY idx_feedback_type (feedback_type)
```

---

## 🏗️ 后端架构

### 文件结构

```
daming-admin/
├─ dm_questionBank/
│  ├─ src/main/java/com/dm/quiz/
│  │  ├─ domain/
│  │  │  └─ DamingFeedback.java              ✅ 实体类
│  │  ├─ mapper/
│  │  │  └─ DamingFeedbackMapper.java        ✅ Mapper接口
│  │  └─ service/
│  │     ├─ IDamingFeedbackService.java      ✅ Service接口
│  │     └─ impl/
│  │        └─ DamingFeedbackServiceImpl.java ✅ Service实现
│  └─ src/main/resources/mapper/quiz/
│     └─ DamingFeedbackMapper.xml            ✅ SQL映射
├─ ruoyi-admin/
│  └─ src/main/java/com/ruoyi/web/controller/quiz/
│     ├─ admin/
│     │  └─ DamingFeedbackController.java    ✅ 后台Controller
│     └─ student/
│        └─ FeedbackController.java          ✅ 前台Controller
└─ sql/2025-11-23/
   ├─ 5-反馈管理表结构.sql                   ✅ 数据库SQL
   └─ 6-反馈管理菜单权限配置.sql             ✅ 菜单权限SQL
```

### 接口列表

#### 后台管理接口

| 接口 | 方法 | 路径 | 权限 | 说明 |
|------|------|------|------|------|
| 列表查询 | GET | /quiz/feedback/list | quiz:feedback:list | 分页查询 |
| 详情查询 | GET | /quiz/feedback/{id} | quiz:feedback:query | 查看详情 |
| 新增 | POST | /quiz/feedback | quiz:feedback:add | 新增反馈 |
| 修改 | PUT | /quiz/feedback | quiz:feedback:edit | 修改反馈 |
| 删除 | DELETE | /quiz/feedback/{ids} | quiz:feedback:remove | 批量删除 |
| 处理反馈 | PUT | /quiz/feedback/handle | quiz:feedback:handle | 处理并回复 |
| 状态统计 | GET | /quiz/feedback/stats/status | quiz:feedback:list | 按状态统计 |
| 类型统计 | GET | /quiz/feedback/stats/type | quiz:feedback:list | 按类型统计 |
| 导出 | POST | /quiz/feedback/export | quiz:feedback:export | 导出Excel |

#### 前台用户接口

| 接口 | 方法 | 路径 | 说明 |
|------|------|------|------|
| 我的反馈 | GET | /student/feedback/my | 查看我的反馈列表 |
| 详情查询 | GET | /student/feedback/{id} | 查看详情 |
| 提交反馈 | POST | /student/feedback | 提交新反馈 |
| 删除反馈 | DELETE | /student/feedback/{id} | 删除（仅待处理） |

---

## 🎨 前端设计

### 后台管理页面

**文件**: `ruoyi-ui/src/views/quiz/feedback/index.vue`

#### 功能特性
1. **搜索筛选**
   - 用户名称模糊搜索
   - 反馈标题模糊搜索
   - 反馈类型筛选（功能建议/Bug反馈/使用问题/其他）
   - 处理状态筛选（待处理/处理中/已处理/已关闭）
   - 优先级筛选（低/中/高）

2. **列表展示**
   - 反馈ID、用户名称
   - 反馈类型（标签）
   - 反馈标题（溢出省略）
   - 优先级（标签）
   - 处理状态（标签）
   - 联系方式、处理人
   - 提交时间
   - 操作按钮（查看/处理/删除）

3. **查看详情弹窗**
   - 使用 `el-descriptions` 展示完整信息
   - 反馈内容和回复内容高亮显示

4. **处理反馈弹窗**
   - 显示反馈标题和内容（只读）
   - 选择处理状态（处理中/已处理/已关闭）
   - 设置优先级（低/中/高）
   - 填写回复内容（必填，最多1000字）

### 前台用户页面

#### 1. 提交反馈页面

**文件**: `daming-front/src/views/feedback/submit.vue`

**功能特性**:
- 选择反馈类型（单选）
- 输入反馈标题（5-200字符）
- 输入详细描述（10-1000字符）
- 填写联系方式（可选）
- 提交按钮 + 重置按钮
- 温馨提示信息

#### 2. 我的反馈列表页面

**文件**: `daming-front/src/views/feedback/my.vue`

**功能特性**:
- 状态筛选（全部/待处理/处理中/已处理/已关闭）
- 卡片式列表展示
- 显示反馈类型、标题、内容预览
- 显示处理状态、提交时间
- 已回复提示徽章
- 操作按钮（查看详情/删除）
- 详情弹窗显示完整信息和管理员回复

---

## 🚀 部署步骤

### 1. 数据库初始化

```bash
# 1. 创建表结构
mysql -u root -p your_database < sql/2025-11-23/5-反馈管理表结构.sql

# 2. 配置菜单权限
mysql -u root -p your_database < sql/2025-11-23/6-反馈管理菜单权限配置.sql
```

**⚠️ 注意**: 菜单权限SQL中的`parent_id=2038`需要根据实际的题库管理菜单ID调整。

查询实际ID：
```sql
SELECT menu_id, menu_name FROM sys_menu WHERE menu_name LIKE '%题库%';
```

### 2. 后端部署

```bash
# 1. 编译项目
cd daming-admin
mvn clean package

# 2. 重启服务
# Windows
restart.bat
# Linux
./restart.sh
```

### 3. 前端部署

#### 后台管理（ruoyi-ui）
```bash
cd ruoyi-ui
# 已创建文件，无需额外操作
# 刷新浏览器即可
```

#### 前台系统（daming-front）
```bash
cd daming-front
# 已创建文件，需要配置路由
```

**前台路由配置** (需要手动添加):

在 `daming-front/src/router/index.js` 中添加：

```javascript
{
  path: '/feedback',
  name: 'Feedback',
  component: () => import('@/views/layout/index.vue'),
  children: [
    {
      path: 'submit',
      name: 'FeedbackSubmit',
      component: () => import('@/views/feedback/submit.vue'),
      meta: { title: '意见反馈' }
    },
    {
      path: 'my',
      name: 'MyFeedback',
      component: () => import('@/views/feedback/my.vue'),
      meta: { title: '我的反馈' }
    }
  ]
}
```

### 4. 权限分配

登录后台管理系统：
1. 进入【系统管理】→【角色管理】
2. 选择角色（如：管理员）→【修改】
3. 在菜单权限树中勾选【反馈管理】及其子权限
4. 保存

---

## 📊 业务流程

### 完整反馈流程

```
用户提交反馈
    ↓
status = 0 (待处理)
    ↓
管理员查看列表
    ↓
点击"处理"按钮
    ↓
status = 1 (处理中)
    ↓
填写回复内容 + 设置优先级
    ↓
status = 2 (已处理)
    ↓
用户查看回复
```

### 状态流转规则

| 当前状态 | 可流转状态 | 说明 |
|---------|-----------|------|
| 待处理(0) | 处理中(1)、已处理(2)、已关闭(3) | 初始状态 |
| 处理中(1) | 已处理(2)、已关闭(3) | 正在处理 |
| 已处理(2) | 已关闭(3) | 处理完成 |
| 已关闭(3) | - | 最终状态 |

---

## 📁 完整文件清单

### SQL文件
```
sql/2025-11-23/
├─ 5-反馈管理表结构.sql                    ✅
└─ 6-反馈管理菜单权限配置.sql              ✅
```

### 后端Java文件
```
dm_questionBank/
├─ domain/DamingFeedback.java             ✅
├─ mapper/DamingFeedbackMapper.java       ✅
├─ mapper/xml/DamingFeedbackMapper.xml    ✅
├─ service/IDamingFeedbackService.java    ✅
└─ service/impl/DamingFeedbackServiceImpl.java ✅

ruoyi-admin/controller/quiz/
├─ admin/DamingFeedbackController.java    ✅
└─ student/FeedbackController.java        ✅
```

### 前端Vue文件
```
ruoyi-ui/src/
├─ api/quiz/feedback.js                   ✅ 后台API
└─ views/quiz/feedback/index.vue          ✅ 后台管理页面

daming-front/src/
├─ api/feedback.js                        ✅ 前台API
└─ views/feedback/
   ├─ submit.vue                          ✅ 提交反馈页面
   └─ my.vue                              ✅ 我的反馈页面
```

### 文档文件
```
doc/service/2025-11-23/
├─ 14-反馈管理模块开发总结.md             ✅
└─ 15-反馈管理模块完整文档.md             ✅ 本文档
```

---

## 🧪 测试指南

### 后端接口测试

使用Postman测试：

```
# 1. 查询反馈列表
GET http://localhost:8080/quiz/feedback/list?pageNum=1&pageSize=10

# 2. 提交反馈（前台）
POST http://localhost:8080/student/feedback
Body: {
  "feedbackType": 1,
  "feedbackTitle": "建议增加夜间模式",
  "feedbackContent": "晚上学习时屏幕太亮，希望能增加夜间模式",
  "contactInfo": "test@example.com"
}

# 3. 处理反馈（后台）
PUT http://localhost:8080/quiz/feedback/handle
Body: {
  "feedbackId": 1,
  "status": 2,
  "replyContent": "感谢您的建议，我们已将此功能加入开发计划"
}

# 4. 查询我的反馈（前台）
GET http://localhost:8080/student/feedback/my?pageNum=1&pageSize=10
```

### 前端功能测试

#### 后台管理测试
- ✅ 登录后台 → 反馈管理
- ✅ 搜索筛选功能
- ✅ 查看反馈详情
- ✅ 处理反馈并回复
- ✅ 删除反馈
- ✅ 导出Excel

#### 前台用户测试
- ✅ 访问 `/feedback/submit`
- ✅ 填写并提交反馈
- ✅ 访问 `/feedback/my`
- ✅ 查看反馈列表和详情
- ✅ 查看管理员回复
- ✅ 删除待处理反馈

---

## ⚠️ 注意事项

### 1. 权限控制
- 前台用户只能查看/删除自己的反馈
- 只能删除待处理状态的反馈
- 后台管理员可以查看所有反馈

### 2. 状态管理
- 处理反馈时必须填写回复内容
- 处理时间自动记录
- 状态只能向后流转，不能回退

### 3. 数据验证
- 反馈标题：5-200字符
- 反馈内容：10-1000字符
- 回复内容：必填，最多1000字符

### 4. 菜单配置
- 注意修改SQL中的`parent_id`
- 分配权限后需要重新登录

---

## 🔄 后续优化建议

### 功能增强
- [ ] 图片上传功能（截图附件）
- [ ] 邮件通知（反馈回复提醒）
- [ ] 反馈评分功能
- [ ] 反馈标签系统
- [ ] 批量处理功能

### 性能优化
- [ ] 反馈列表缓存
- [ ] 全文检索支持
- [ ] 统计数据缓存

### 用户体验
- [ ] 富文本编辑器
- [ ] 图片预览功能
- [ ] 实时消息推送
- [ ] 反馈进度时间轴

---

## 📞 技术支持

如有问题，请参考：
- 后端接口文档
- 前端组件文档
- 数据库设计文档

**文档版本**: v1.0  
**最后更新**: 2025-11-23  
**维护人员**: daming团队
