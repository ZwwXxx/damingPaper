# 登录重定向功能实现说明

## 功能概述

允许用户访问首页而不需要登录，但访问需要权限的页面（如个人中心）时自动跳转登录页，登录成功后返回原页面。

## 核心改动

### 1. 数据库新增字段
在`wx_scan_log`表添加`redirect_url`字段，保存登录成功后要跳转的URL。

### 2. 前端路由守卫
- 白名单包含首页，允许未登录访问
- 访问需要登录的页面时，携带redirect参数跳转登录页
- 例如：访问`/profile` → 跳转到`/login?redirect=/profile`

### 3. WebSocket消息格式
- 不带重定向：`request_qrcode`
- 带重定向：`request_qrcode:/profile`

### 4. 后端处理
- WebSocket接收并解析redirect参数
- 创建扫码记录时保存redirect_url
- 登录成功后通知前端：`SUCCESS:token`
- 前端根据redirect参数跳转

## 使用示例

参见完整代码文件：
- 路由守卫：`daming-front/src/router/permission.js`
- 登录页面：`daming-front/src/views/login/WxLogin.vue`
- 后端处理：`WxLoginWebSocketHandler.java`
