# å­¦ä¹ æ—¶é—´ç»Ÿè®¡åŠŸèƒ½æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **åŠŸèƒ½åç§°**: å­¦ä¹ æ—¶é—´ç»Ÿè®¡
- **åˆ›å»ºæ—¥æœŸ**: 2025-11-23
- **ç‰ˆæœ¬**: v1.0
- **ç›¸å…³æ¨¡å—**: ä¸ªäººå­¦ä¹ æŠ¥è¡¨

---

## ğŸ“Š åŠŸèƒ½æ¦‚è¿°

å­¦ä¹ æ—¶é—´ç»Ÿè®¡åŠŸèƒ½ç”¨äºè¿½è¸ªå’Œåˆ†æç”¨æˆ·çš„å­¦ä¹ è¡Œä¸ºï¼ŒåŒ…æ‹¬å­¦ä¹ æ—¶é•¿ã€å­¦ä¹ å¤©æ•°ã€è¿ç»­å­¦ä¹ å¤©æ•°ä»¥åŠ24å°æ—¶å­¦ä¹ æ—¶é—´åˆ†å¸ƒã€‚è¯¥åŠŸèƒ½å¸®åŠ©ç”¨æˆ·äº†è§£è‡ªå·±çš„å­¦ä¹ ä¹ æƒ¯ï¼Œä¼˜åŒ–å­¦ä¹ æ—¶é—´å®‰æ’ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ç´¯è®¡å­¦ä¹ æ—¶é•¿
- **å®šä¹‰**: ç»Ÿè®¡ç”¨æˆ·æ‰€æœ‰è€ƒè¯•çš„æ€»åšé¢˜æ—¶é•¿
- **å•ä½**: åˆ†é’Ÿï¼ˆå‰ç«¯è½¬æ¢ä¸ºå°æ—¶/åˆ†é’Ÿæ˜¾ç¤ºï¼‰
- **ç”¨é€”**: åæ˜ ç”¨æˆ·æ€»ä½“å­¦ä¹ æŠ•å…¥

### 2. å­¦ä¹ å¤©æ•°
- **å®šä¹‰**: ç»Ÿè®¡ç”¨æˆ·åœ¨æŒ‡å®šæ—¶é—´èŒƒå›´å†…æœ‰å­¦ä¹ æ´»åŠ¨çš„å¤©æ•°
- **é»˜è®¤èŒƒå›´**: æœ€è¿‘30å¤©
- **ç»Ÿè®¡ç»´åº¦**: å»é‡æ—¥æœŸç»Ÿè®¡

### 3. è¿ç»­å­¦ä¹ å¤©æ•°
- **å®šä¹‰**: ç»Ÿè®¡ç”¨æˆ·è¿ç»­å­¦ä¹ çš„å¤©æ•°ï¼ˆä»å½“å‰æ—¥æœŸå¾€å‰æ¨ç®—ï¼‰
- **è®¡ç®—æ–¹å¼**: åŸºäºæ—¥æœŸè¿ç»­æ€§ç®—æ³•
- **ç‰¹ç‚¹**: æ¿€åŠ±ç”¨æˆ·ä¿æŒå­¦ä¹ ä¹ æƒ¯

### 4. 24å°æ—¶å­¦ä¹ æ—¶é—´åˆ†å¸ƒ
- **å®šä¹‰**: ç»Ÿè®¡ç”¨æˆ·åœ¨ä¸€å¤©24å°æ—¶å†…å„æ—¶æ®µçš„å­¦ä¹ æ´»åŠ¨é¢‘æ¬¡
- **æ—¶é—´èŒƒå›´**: æœ€è¿‘30å¤©
- **å±•ç¤ºæ–¹å¼**: æŸ±çŠ¶å›¾ï¼Œä¸åŒæ—¶æ®µæ˜¾ç¤ºä¸åŒé¢œè‰²
- **æ—¶æ®µåˆ’åˆ†**:
  - æ—©ä¸Šï¼ˆ6:00-11:59ï¼‰ï¼šç»¿è‰² `#67C23A`
  - ä¸‹åˆï¼ˆ12:00-17:59ï¼‰ï¼šè“è‰² `#409EFF`
  - æ™šä¸Šï¼ˆ18:00-21:59ï¼‰ï¼šæ©™è‰² `#E6A23C`
  - æ·±å¤œï¼ˆ22:00-5:59ï¼‰ï¼šç°è‰² `#909399`

---

## ğŸ—„ï¸ æ•°æ®æ¥æº

å­¦ä¹ æ—¶é—´ç»Ÿè®¡åŸºäºä¸¤å¼ æ ¸å¿ƒæ•°æ®è¡¨ï¼š

### 1. daming_paper_answerï¼ˆè¯•å·ç­”é¢˜è®°å½•è¡¨ï¼‰

```sql
CREATE TABLE `daming_paper_answer` (
  `paper_answer_id` int(11) NOT NULL AUTO_INCREMENT,
  `paper_name` varchar(255) NOT NULL,
  `paper_id` int(11) NOT NULL,
  `create_user` varchar(255) NOT NULL,           -- ç”¨æˆ·æ ‡è¯†
  `paper_score` int(11) NOT NULL,
  `final_score` int(11) DEFAULT 0,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP, -- è€ƒè¯•æ—¶é—´ï¼ˆç»Ÿè®¡ä¾æ®ï¼‰
  `do_time` int(11) DEFAULT NULL,                -- åšé¢˜æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  PRIMARY KEY (`paper_answer_id`)
)
```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
- `create_user`: ç”¨æˆ·æ ‡è¯†ï¼Œç”¨äºç­›é€‰ç”¨æˆ·æ•°æ®
- `create_time`: ç­”é¢˜æ—¶é—´ï¼Œç”¨äºç»Ÿè®¡å­¦ä¹ å¤©æ•°å’Œæ—¶é—´åˆ†å¸ƒ
- `do_time`: åšé¢˜æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼Œç”¨äºç´¯è®¡å­¦ä¹ æ—¶é•¿

### 2. daming_question_answerï¼ˆé¢˜ç›®ç­”é¢˜è®°å½•è¡¨ï¼‰

```sql
CREATE TABLE `daming_question_answer` (
  `answer_id` int(11) NOT NULL AUTO_INCREMENT,
  `create_user` varchar(255) NOT NULL,           -- ç”¨æˆ·æ ‡è¯†
  `paper_id` int(11) NOT NULL,
  `question_id` int(11) NOT NULL,
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP, -- ç­”é¢˜æ—¶é—´
  `is_correct` tinyint(4) DEFAULT NULL,
  PRIMARY KEY (`answer_id`)
)
```

**å…³é”®å­—æ®µè¯´æ˜**ï¼š
- `create_user`: ç”¨æˆ·æ ‡è¯†
- `create_time`: ç­”é¢˜æ—¶é—´ï¼Œç”¨äºç»Ÿè®¡å­¦ä¹ å¤©æ•°å’Œæ—¶é—´åˆ†å¸ƒ

---

## ğŸ” ç»Ÿè®¡åŸç†è¯¦è§£

### 1. ç´¯è®¡å­¦ä¹ æ—¶é•¿

**SQLå®ç°**ï¼š
```sql
SELECT IFNULL(SUM(do_time), 0)
FROM daming_paper_answer
WHERE create_user = #{userId}
```

**åŸç†è¯´æ˜**ï¼š
- ç›´æ¥ç´¯åŠ `daming_paper_answer`è¡¨ä¸­çš„`do_time`å­—æ®µ
- `do_time`å­—æ®µåœ¨ç”¨æˆ·æäº¤è¯•å·æ—¶è®°å½•ï¼Œå•ä½ä¸ºåˆ†é’Ÿ
- ä½¿ç”¨`IFNULL`ç¡®ä¿æ²¡æœ‰æ•°æ®æ—¶è¿”å›0è€ŒéNULL

**å‰ç«¯è½¬æ¢**ï¼š
```javascript
formatTime(minutes) {
  if (!minutes) return '0å°æ—¶'
  const hours = Math.floor(minutes / 60)
  const mins = minutes % 60
  if (hours === 0) return `${mins}åˆ†é’Ÿ`
  if (mins === 0) return `${hours}å°æ—¶`
  return `${hours}h${mins}m`
}
```

---

### 2. å­¦ä¹ å¤©æ•°ï¼ˆæœ€è¿‘Nå¤©ï¼‰

**SQLå®ç°**ï¼š
```sql
SELECT COUNT(DISTINCT DATE(create_time))
FROM (
    SELECT create_time FROM daming_question_answer 
    WHERE create_user = #{userId} 
      AND create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
    UNION ALL
    SELECT create_time FROM daming_paper_answer 
    WHERE create_user = #{userId} 
      AND create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
) AS study_records
```

**åŸç†è¯´æ˜**ï¼š
1. **æ•°æ®åˆå¹¶**: ä½¿ç”¨`UNION ALL`åˆå¹¶é¢˜ç›®ç­”é¢˜è®°å½•å’Œè¯•å·ç­”é¢˜è®°å½•
2. **æ—¶é—´èŒƒå›´**: `DATE_SUB(CURDATE(), INTERVAL #{days} DAY)`è·å–æœ€è¿‘Nå¤©çš„æ•°æ®
3. **æ—¥æœŸå»é‡**: `COUNT(DISTINCT DATE(create_time))`ç»Ÿè®¡å”¯ä¸€æ—¥æœŸæ•°
4. **ç»Ÿè®¡ç»´åº¦**: åªè¦å½“å¤©æœ‰ä»»ä½•å­¦ä¹ æ´»åŠ¨ï¼ˆåšé¢˜æˆ–è€ƒè¯•ï¼‰å°±è®¡å…¥ä¸€å¤©

**ä¸ºä»€ä¹ˆè¦åˆå¹¶ä¸¤å¼ è¡¨ï¼Ÿ**
- ç”¨æˆ·å¯èƒ½åªåšé¢˜ä¸è€ƒè¯•ï¼Œæˆ–åªè€ƒè¯•ä¸å•ç‹¬ç»ƒä¹ 
- åˆå¹¶ç»Ÿè®¡ç¡®ä¿å®Œæ•´åæ˜ å­¦ä¹ å¤©æ•°
- é¿å…é—æ¼ä»»ä½•å­¦ä¹ æ´»åŠ¨

---

### 3. è¿ç»­å­¦ä¹ å¤©æ•°

**SQLå®ç°**ï¼š
```sql
SELECT
    IFNULL(MAX(continuous_days), 0) AS continuous_days
FROM (
    SELECT
        @days := IF(@prev_date = DATE_SUB(study_date, INTERVAL 1 DAY), @days + 1, 1) AS continuous_days,
        @prev_date := study_date
    FROM (
        SELECT DISTINCT DATE(create_time) AS study_date
        FROM (
            SELECT create_time FROM daming_question_answer WHERE create_user = #{userId}
            UNION ALL
            SELECT create_time FROM daming_paper_answer WHERE create_user = #{userId}
        ) AS all_study
        ORDER BY study_date DESC
    ) AS dates,
    (SELECT @days := 0, @prev_date := CURDATE()) AS vars
) AS continuous_count
```

**åŸç†è¯´æ˜**ï¼ˆä»å†…åˆ°å¤–ï¼‰ï¼š

**ç¬¬ä¸€å±‚ï¼šæ•°æ®åˆå¹¶ä¸å»é‡**
```sql
SELECT DISTINCT DATE(create_time) AS study_date
FROM (
    SELECT create_time FROM daming_question_answer WHERE create_user = #{userId}
    UNION ALL
    SELECT create_time FROM daming_paper_answer WHERE create_user = #{userId}
) AS all_study
ORDER BY study_date DESC
```
- åˆå¹¶ä¸¤å¼ è¡¨çš„å­¦ä¹ è®°å½•
- æå–æ—¥æœŸéƒ¨åˆ†ï¼ˆ`DATE(create_time)`ï¼‰
- å»é‡ï¼ˆ`DISTINCT`ï¼‰å¾—åˆ°æ‰€æœ‰å­¦ä¹ æ—¥æœŸ
- å€’åºæ’åˆ—ï¼ˆ`ORDER BY study_date DESC`ï¼‰ï¼Œä»æœ€è¿‘å¼€å§‹è®¡ç®—

**ç¬¬äºŒå±‚ï¼šå˜é‡åˆå§‹åŒ–**
```sql
(SELECT @days := 0, @prev_date := CURDATE()) AS vars
```
- `@days`: è¿ç»­å¤©æ•°è®¡æ•°å™¨ï¼Œåˆå§‹å€¼ä¸º0
- `@prev_date`: å‰ä¸€ä¸ªæ—¥æœŸï¼Œåˆå§‹å€¼ä¸ºå½“å‰æ—¥æœŸ

**ç¬¬ä¸‰å±‚ï¼šè¿ç»­æ€§åˆ¤æ–­**
```sql
@days := IF(@prev_date = DATE_SUB(study_date, INTERVAL 1 DAY), @days + 1, 1) AS continuous_days,
@prev_date := study_date
```
- åˆ¤æ–­å½“å‰æ—¥æœŸæ˜¯å¦ç­‰äºå‰ä¸€ä¸ªæ—¥æœŸå‡1å¤©
- å¦‚æœè¿ç»­ï¼Œè®¡æ•°å™¨åŠ 1ï¼ˆ`@days + 1`ï¼‰
- å¦‚æœä¸è¿ç»­ï¼Œé‡ç½®ä¸º1
- æ›´æ–°`@prev_date`ä¸ºå½“å‰æ—¥æœŸ

**ç¬¬å››å±‚ï¼šå–æœ€å¤§å€¼**
```sql
SELECT IFNULL(MAX(continuous_days), 0) AS continuous_days
```
- å–æ‰€æœ‰è¿ç»­æ®µä¸­çš„æœ€å¤§å€¼
- ç”±äºæ˜¯ä»æœ€è¿‘æ—¥æœŸå¼€å§‹ï¼Œæœ€å¤§å€¼å³ä¸ºå½“å‰çš„è¿ç»­å­¦ä¹ å¤©æ•°

**ç¤ºä¾‹è¯´æ˜**ï¼š
å‡è®¾ç”¨æˆ·å­¦ä¹ æ—¥æœŸä¸ºï¼š2025-11-23ã€2025-11-22ã€2025-11-21ã€2025-11-18

å¤„ç†è¿‡ç¨‹ï¼š
1. 2025-11-23ï¼š@prev_date=2025-11-23, 2025-11-23 = 2025-11-23-1? æ˜¯ â†’ @days=1
2. 2025-11-22ï¼š@prev_date=2025-11-22, 2025-11-22 = 2025-11-22-1? æ˜¯ â†’ @days=2
3. 2025-11-21ï¼š@prev_date=2025-11-21, 2025-11-21 = 2025-11-21-1? æ˜¯ â†’ @days=3
4. 2025-11-18ï¼š@prev_date=2025-11-18, 2025-11-18 = 2025-11-21-1? å¦ â†’ @days=1

ç»“æœï¼šMAX(continuous_days) = 3ï¼ˆè¿ç»­å­¦ä¹ 3å¤©ï¼‰

---

### 4. 24å°æ—¶å­¦ä¹ æ—¶é—´åˆ†å¸ƒ

**SQLå®ç°**ï¼š
```sql
SELECT
    HOUR(create_time) AS hour,
    COUNT(*) AS count
FROM (
    SELECT create_time FROM daming_question_answer 
    WHERE create_user = #{userId} 
      AND create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
    UNION ALL
    SELECT create_time FROM daming_paper_answer 
    WHERE create_user = #{userId} 
      AND create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
) AS study_records
GROUP BY HOUR(create_time)
ORDER BY hour
```

**åŸç†è¯´æ˜**ï¼š
1. **æ•°æ®åˆå¹¶**: åˆå¹¶é¢˜ç›®å’Œè¯•å·çš„ç­”é¢˜è®°å½•
2. **æ—¶é—´èŒƒå›´**: ç»Ÿè®¡æœ€è¿‘Nå¤©ï¼ˆé»˜è®¤30å¤©ï¼‰çš„æ•°æ®
3. **å°æ—¶æå–**: `HOUR(create_time)`æå–æ—¶é—´çš„å°æ—¶éƒ¨åˆ†ï¼ˆ0-23ï¼‰
4. **é¢‘æ¬¡ç»Ÿè®¡**: `COUNT(*)`ç»Ÿè®¡æ¯ä¸ªå°æ—¶æ®µçš„æ´»åŠ¨æ¬¡æ•°
5. **åˆ†ç»„æ’åº**: æŒ‰å°æ—¶åˆ†ç»„å¹¶æ’åº

**å‰ç«¯æ•°æ®è¡¥å…¨**ï¼š
```javascript
// è¡¥å…¨24å°æ—¶æ•°æ®
const fullHourData = []
for (let i = 0; i < 24; i++) {
  const found = hourData.find(item => item.hour === i)
  fullHourData.push(found ? found.count : 0)
}
```
- SQLåªè¿”å›æœ‰æ•°æ®çš„å°æ—¶
- å‰ç«¯éœ€è¦è¡¥å…¨0-23æ‰€æœ‰å°æ—¶
- æ²¡æœ‰æ•°æ®çš„å°æ—¶æ˜¾ç¤ºä¸º0

**å‰ç«¯å¯è§†åŒ–**ï¼š
```javascript
itemStyle: {
  color: (params) => {
    const hour = params.dataIndex
    if (hour >= 6 && hour < 12) return '#67C23A'  // æ—©ä¸Š-ç»¿è‰²
    if (hour >= 12 && hour < 18) return '#409EFF' // ä¸‹åˆ-è“è‰²
    if (hour >= 18 && hour < 22) return '#E6A23C' // æ™šä¸Š-æ©™è‰²
    return '#909399'                               // æ·±å¤œ-ç°è‰²
  }
}
```

---

## ğŸ’» ä»£ç å®ç°

### åç«¯å®ç°

#### 1. Mapperæ¥å£
```java
// PersonalDashboardMapper.java
public interface PersonalDashboardMapper {
    
    /** è·å–ç”¨æˆ·ç´¯è®¡å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ */
    Long getTotalStudyTime(@Param("userId") String username);
    
    /** è·å–ç”¨æˆ·å­¦ä¹ å¤©æ•°ï¼ˆæœ€è¿‘Nå¤©ï¼‰ */
    Long getStudyDays(@Param("userId") String username, @Param("days") Integer days);
    
    /** è·å–ç”¨æˆ·è¿ç»­å­¦ä¹ å¤©æ•° */
    Long getContinuousStudyDays(@Param("userId") String username);
    
    /** è·å–ç”¨æˆ·24å°æ—¶å­¦ä¹ æ—¶é—´åˆ†å¸ƒï¼ˆæœ€è¿‘Nå¤©ï¼‰ */
    List<Map<String, Object>> getHourDistribution(@Param("userId") String username, @Param("days") Integer days);
}
```

#### 2. Serviceå®ç°
```java
// PersonalDashboardServiceImpl.java
@Override
public StudyTimeDto getStudyTimeDistribution(String username, Integer days) {
    StudyTimeDto dto = new StudyTimeDto();
    
    Integer queryDays = days != null ? days : 30;
    
    // å­¦ä¹ å¤©æ•°
    Long studyDays = personalDashboardMapper.getStudyDays(username, queryDays);
    dto.setStudyDays(studyDays != null ? studyDays : 0L);
    
    // è¿ç»­å­¦ä¹ å¤©æ•°
    Long continuousDays = personalDashboardMapper.getContinuousStudyDays(username);
    dto.setContinuousDays(continuousDays != null ? continuousDays : 0L);
    
    // 24å°æ—¶åˆ†å¸ƒ
    List<Map<String, Object>> hourData = personalDashboardMapper.getHourDistribution(username, queryDays);
    List<HourDistribution> hourList = new ArrayList<>();
    for (Map<String, Object> data : hourData) {
        HourDistribution dist = new HourDistribution();
        dist.setHour(((Number) data.get("hour")).intValue());
        dist.setCount(((Number) data.get("count")).longValue());
        hourList.add(dist);
    }
    dto.setHourDistribution(hourList);
    
    return dto;
}
```

#### 3. Controlleræ¥å£
```java
// PersonalDashboardController.java
@GetMapping("/study-time")
public AjaxResult getStudyTimeDistribution(@RequestParam(defaultValue = "30") Integer days) {
    String username = SecurityUtils.getUsername();
    StudyTimeDto data = personalDashboardService.getStudyTimeDistribution(username, days);
    return AjaxResult.success(data);
}
```

### å‰ç«¯å®ç°

#### 1. APIè°ƒç”¨
```javascript
// personal-dashboard.js
export function getStudyTimeDistribution(days = 30) {
  return request({
    url: '/api/personal/dashboard/study-time',
    method: 'get',
    params: { days }
  })
}
```

#### 2. æ•°æ®åŠ è½½
```javascript
// personal.vue
async loadStudyTime() {
  try {
    const res = await getStudyTimeDistribution(30)
    if (res.code === 200) {
      this.studyTimeData = res.data || { 
        studyDays: 0, 
        continuousDays: 0, 
        hourDistribution: [] 
      }
    }
    this.$nextTick(() => {
      this.renderStudyTimeChart()
    })
  } catch (error) {
    console.error('=== å­¦ä¹ æ—¶é—´APIé”™è¯¯:', error)
  }
}
```

#### 3. å›¾è¡¨æ¸²æŸ“
```javascript
renderStudyTimeChart() {
  const chartDom = document.getElementById('studyTimeChart')
  if (!chartDom) return

  const chart = echarts.init(chartDom)
  const hourData = this.studyTimeData.hourDistribution || []
  
  // è¡¥å…¨24å°æ—¶æ•°æ®
  const fullHourData = []
  for (let i = 0; i < 24; i++) {
    const found = hourData.find(item => item.hour === i)
    fullHourData.push(found ? found.count : 0)
  }

  const option = {
    tooltip: {
      trigger: 'axis',
      formatter: (params) => {
        return `${params[0].name}:00 - ${params[0].name}:59<br/>æ´»åŠ¨æ¬¡æ•°: ${params[0].value}`
      }
    },
    xAxis: {
      type: 'category',
      data: Array.from({ length: 24 }, (_, i) => i),
      name: 'å°æ—¶'
    },
    yAxis: {
      type: 'value',
      name: 'æ´»åŠ¨æ¬¡æ•°'
    },
    series: [{
      type: 'bar',
      data: fullHourData,
      itemStyle: {
        color: (params) => {
          const hour = params.dataIndex
          if (hour >= 6 && hour < 12) return '#67C23A'
          if (hour >= 12 && hour < 18) return '#409EFF'
          if (hour >= 18 && hour < 22) return '#E6A23C'
          return '#909399'
        }
      },
      barWidth: '60%'
    }]
  }

  chart.setOption(option)
}
```

---

## ğŸ“ˆ æ•°æ®æµç¨‹å›¾

```
ç”¨æˆ·å­¦ä¹ æ´»åŠ¨
    â”‚
    â”œâ”€â†’ åšé¢˜ï¼ˆdaming_question_answerè¡¨ï¼‰
    â”‚       â””â”€â†’ create_timeè®°å½•
    â”‚
    â””â”€â†’ è€ƒè¯•ï¼ˆdaming_paper_answerè¡¨ï¼‰
            â”œâ”€â†’ create_timeè®°å½•
            â””â”€â†’ do_timeè®°å½•ï¼ˆå­¦ä¹ æ—¶é•¿ï¼‰
                â”‚
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  åç«¯ç»Ÿè®¡å¤„ç†          â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ 1. ç´¯è®¡å­¦ä¹ æ—¶é•¿       â”‚â† SUM(do_time)
        â”‚ 2. å­¦ä¹ å¤©æ•°           â”‚â† COUNT(DISTINCT DATE)
        â”‚ 3. è¿ç»­å­¦ä¹ å¤©æ•°       â”‚â† è¿ç»­æ€§ç®—æ³•
        â”‚ 4. 24å°æ—¶åˆ†å¸ƒ         â”‚â† GROUP BY HOUR
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å‰ç«¯å±•ç¤º              â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚ â€¢ å¡ç‰‡ç»Ÿè®¡æ•°æ®        â”‚
        â”‚ â€¢ 24å°æ—¶æŸ±çŠ¶å›¾        â”‚
        â”‚ â€¢ æ—¶æ®µé¢œè‰²åŒºåˆ†        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ UIå±•ç¤º

### 1. å­¦ä¹ ç»Ÿè®¡å¡ç‰‡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“… å­¦ä¹ ç»Ÿè®¡       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å­¦ä¹ å¤©æ•°            â”‚
â”‚     15 å¤©           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿ç»­å­¦ä¹             â”‚
â”‚  ğŸ… 3 å¤©            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç´¯è®¡å­¦ä¹             â”‚
â”‚   5å°æ—¶30åˆ†         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. 24å°æ—¶å­¦ä¹ æ—¶é—´åˆ†å¸ƒå›¾
- æ¨ªè½´ï¼š0-23å°æ—¶
- çºµè½´ï¼šæ´»åŠ¨æ¬¡æ•°
- æŸ±çŠ¶å›¾ï¼šä¸åŒæ—¶æ®µä¸åŒé¢œè‰²
- æç¤ºä¿¡æ¯ï¼šé¼ æ ‡æ‚¬æµ®æ˜¾ç¤ºå…·ä½“æ—¶æ®µå’Œæ´»åŠ¨æ¬¡æ•°

---

## âš™ï¸ æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–**: åœ¨`create_user`å’Œ`create_time`å­—æ®µä¸Šå»ºç«‹ç´¢å¼•
- **æ—¶é—´èŒƒå›´é™åˆ¶**: ä½¿ç”¨`DATE_SUB`é™åˆ¶æŸ¥è¯¢èŒƒå›´ï¼Œé¿å…å…¨è¡¨æ‰«æ
- **æ•°æ®èšåˆ**: ä½¿ç”¨`GROUP BY`å’Œèšåˆå‡½æ•°åœ¨æ•°æ®åº“å±‚é¢å®Œæˆç»Ÿè®¡

### 2. å‰ç«¯ä¼˜åŒ–
- **å›¾è¡¨å¤ç”¨**: ä½¿ç”¨`dispose()`é”€æ¯æ—§å›¾è¡¨ï¼Œé¿å…å†…å­˜æ³„æ¼
- **æ•°æ®ç¼“å­˜**: æ•°æ®å­˜å‚¨åœ¨Vueå®ä¾‹ä¸­ï¼Œé¿å…é‡å¤è¯·æ±‚
- **å¼‚æ­¥æ¸²æŸ“**: ä½¿ç”¨`$nextTick`ç¡®ä¿DOMå‡†å¤‡å°±ç»ªåå†æ¸²æŸ“

### 3. å¹¶å‘ä¼˜åŒ–
```javascript
async loadAllData() {
  await Promise.all([
    this.loadOverview(),
    this.loadExamTrend(),
    this.loadWrongQuestions(),
    this.loadStudyTime()  // å¹¶å‘åŠ è½½
  ])
}
```

---

## ğŸ”§ æ‰©å±•æ€§è€ƒè™‘

### 1. å¯é…ç½®çš„æ—¶é—´èŒƒå›´
å½“å‰é»˜è®¤ç»Ÿè®¡æœ€è¿‘30å¤©ï¼Œå¯æ‰©å±•ä¸ºç”¨æˆ·è‡ªå®šä¹‰ï¼š
```javascript
<el-select v-model="studyTimeDays" @change="loadStudyTime">
  <el-option label="æœ€è¿‘7å¤©" value="7"></el-option>
  <el-option label="æœ€è¿‘30å¤©" value="30"></el-option>
  <el-option label="æœ€è¿‘90å¤©" value="90"></el-option>
</el-select>
```

### 2. å­¦ä¹ æ•ˆç‡åˆ†æ
åŸºäºå­¦ä¹ æ—¶é•¿å’Œæˆç»©ï¼Œè®¡ç®—å­¦ä¹ æ•ˆç‡ï¼š
```sql
SELECT 
  AVG(final_score / NULLIF(do_time, 0)) AS efficiency
FROM daming_paper_answer
WHERE create_user = #{userId}
```

### 3. å­¦ä¹ å»ºè®®
æ ¹æ®24å°æ—¶åˆ†å¸ƒæ•°æ®ï¼Œåˆ†æç”¨æˆ·çš„æœ€ä½³å­¦ä¹ æ—¶æ®µï¼Œæä¾›ä¸ªæ€§åŒ–å»ºè®®ã€‚

---

## ğŸ› å·²çŸ¥é—®é¢˜ä¸æ³¨æ„äº‹é¡¹

### 1. è¿ç»­å­¦ä¹ å¤©æ•°çš„è¾¹ç•Œæƒ…å†µ
- å¦‚æœç”¨æˆ·ä»Šå¤©æœªå­¦ä¹ ï¼Œè¿ç»­å¤©æ•°ä¼šä¸­æ–­
- ç®—æ³•ä»æœ€è¿‘æ—¥æœŸå¼€å§‹è®¡ç®—ï¼Œç¡®ä¿å‡†ç¡®æ€§

### 2. æ—¶åŒºé—®é¢˜
- `create_time`ä½¿ç”¨æœåŠ¡å™¨æ—¶åŒº
- 24å°æ—¶åˆ†å¸ƒåŸºäºæ•°æ®åº“æ—¶åŒº
- éœ€è¦ç¡®ä¿æœåŠ¡å™¨æ—¶åŒºé…ç½®æ­£ç¡®

### 3. æ•°æ®é‡è€ƒè™‘
- å†å²æ•°æ®è¿‡å¤šæ—¶ï¼ŒæŸ¥è¯¢å¯èƒ½è¾ƒæ…¢
- å»ºè®®å¯¹å†å²æ•°æ®è¿›è¡Œå½’æ¡£
- æˆ–æ·»åŠ æ•°æ®èŒƒå›´é™åˆ¶

---

## ğŸ“ æµ‹è¯•å»ºè®®

### 1. å•å…ƒæµ‹è¯•
```java
@Test
public void testGetStudyDays() {
    Long days = personalDashboardMapper.getStudyDays("testUser", 30);
    assertNotNull(days);
    assertTrue(days >= 0);
}

@Test
public void testGetContinuousDays() {
    Long days = personalDashboardMapper.getContinuousStudyDays("testUser");
    assertNotNull(days);
    assertTrue(days >= 0);
}
```

### 2. é›†æˆæµ‹è¯•
- æ¨¡æ‹Ÿç”¨æˆ·è¿ç»­å¤šå¤©å­¦ä¹ ï¼ŒéªŒè¯è¿ç»­å¤©æ•°è®¡ç®—
- åœ¨ä¸åŒæ—¶æ®µåˆ›å»ºå­¦ä¹ è®°å½•ï¼ŒéªŒè¯24å°æ—¶åˆ†å¸ƒ
- éªŒè¯è¾¹ç•Œæƒ…å†µï¼ˆæ— æ•°æ®ã€å•å¤©æ•°æ®ã€è·¨æœˆæ•°æ®ç­‰ï¼‰

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ä¸ªäººå­¦ä¹ æŠ¥è¡¨è§„åˆ’æ–‡æ¡£](./9-å‰å°ä¸ªäººå­¦ä¹ æŠ¥è¡¨è§„åˆ’æ–‡æ¡£.md)
- [å‰å°ä¸ªäººæŠ¥è¡¨APIæ¥å£æ–‡æ¡£](./10-å‰å°ä¸ªäººæŠ¥è¡¨APIæ¥å£æ–‡æ¡£.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](../../sql/all/struct/ry-vue.sql)

---

## ğŸ”„ æ›´æ–°æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | æ›´æ–°å†…å®¹ |
|------|------|----------|
| v1.0 | 2025-11-23 | åˆå§‹ç‰ˆæœ¬ï¼Œå®Œæ•´çš„å­¦ä¹ æ—¶é—´ç»Ÿè®¡åŠŸèƒ½å®ç° |

---

## âœ… æ€»ç»“

å­¦ä¹ æ—¶é—´ç»Ÿè®¡åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æ ¸å¿ƒæœºåˆ¶å®ç°ï¼š

1. **å¤šè¡¨è”åˆç»Ÿè®¡**: åˆå¹¶`daming_question_answer`å’Œ`daming_paper_answer`ä¸¤å¼ è¡¨çš„æ•°æ®
2. **æ—¶é—´ç»´åº¦åˆ†æ**: ä»æ—¥æœŸã€å°æ—¶ç­‰å¤šä¸ªç»´åº¦ç»Ÿè®¡å­¦ä¹ è¡Œä¸º
3. **è¿ç»­æ€§ç®—æ³•**: é€šè¿‡MySQLå˜é‡å®ç°è¿ç»­å­¦ä¹ å¤©æ•°çš„è®¡ç®—
4. **æ•°æ®å¯è§†åŒ–**: ä½¿ç”¨EChartså®ç°ç›´è§‚çš„å›¾è¡¨å±•ç¤º
5. **æ€§èƒ½ä¼˜åŒ–**: æ•°æ®åº“ç´¢å¼•ã€æ—¶é—´èŒƒå›´é™åˆ¶ã€å‰ç«¯å¹¶å‘åŠ è½½

è¯¥åŠŸèƒ½ä¸ä»…å¸®åŠ©ç”¨æˆ·äº†è§£å­¦ä¹ æŠ•å…¥ï¼Œè¿˜èƒ½å‘ç°å­¦ä¹ ä¹ æƒ¯ï¼Œä¸ºä¼˜åŒ–å­¦ä¹ è®¡åˆ’æä¾›æ•°æ®æ”¯æŒã€‚
