# æ–‡ä»¶ä¸Šä¼ 2MBé™åˆ¶å®æ–½æ–¹æ¡ˆ

## å®æ–½æ—¥æœŸ
2025-11-29

## éœ€æ±‚æè¿°
ä¸ºæ‰€æœ‰å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ·»åŠ 2MBæ–‡ä»¶å¤§å°é™åˆ¶ï¼Œè¶…å‡ºæ—¶ç»™å‡ºå‹å¥½æç¤ºã€‚

## å®æ–½å†…å®¹

### 1. åç«¯é™åˆ¶å®æ–½

#### ä¿®æ”¹æ–‡ä»¶ï¼š`CommonController.java`
**è·¯å¾„ï¼š** `ruoyi-admin/src/main/java/com/ruoyi/web/controller/common/CommonController.java`

**ä¿®æ”¹å†…å®¹ï¼š**
```java
@PostMapping("/upload")
public AjaxResult uploadFile(MultipartFile file) throws Exception {
    try {
        // â­ æ–‡ä»¶å¤§å°é™åˆ¶ï¼š2MB
        long maxFileSize = 2 * 1024 * 1024; // 2MB = 2 * 1024 * 1024 bytes
        if (file.getSize() > maxFileSize) {
            return AjaxResult.error("æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MBï¼Œå½“å‰æ–‡ä»¶å¤§å°ï¼š" + formatFileSize(file.getSize()));
        }
        
        // â­ æ–‡ä»¶ç±»å‹é™åˆ¶ï¼šä»…å…è®¸å›¾ç‰‡
        String contentType = file.getContentType();
        if (contentType == null || !contentType.startsWith("image/")) {
            return AjaxResult.error("åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶ç±»å‹ï¼š" + contentType);
        }
        
        // ... åŸæœ‰ä¸Šä¼ é€»è¾‘
    }
}
```

**æ–°å¢å·¥å…·æ–¹æ³•ï¼š**
```java
private String formatFileSize(long size) {
    if (size < 1024) {
        return size + "B";
    } else if (size < 1024 * 1024) {
        return String.format("%.1fKB", size / 1024.0);
    } else if (size < 1024 * 1024 * 1024) {
        return String.format("%.1fMB", size / (1024.0 * 1024.0));
    } else {
        return String.format("%.1fGB", size / (1024.0 * 1024.0 * 1024.0));
    }
}
```

#### æ‰¹é‡ä¸Šä¼ æ¥å£
åŒæ ·åœ¨`/uploads`æ¥å£ä¸­æ·»åŠ ç›¸åŒé™åˆ¶ï¼Œç¡®ä¿æ‰¹é‡ä¸Šä¼ æ—¶æ¯ä¸ªæ–‡ä»¶éƒ½è¢«éªŒè¯ã€‚

### 2. å‰ç«¯ç»Ÿä¸€å·¥å…·

#### åˆ›å»ºæ–‡ä»¶ï¼š`upload.js`
**è·¯å¾„ï¼š** `src/utils/upload.js`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- æ–‡ä»¶å¤§å°éªŒè¯ï¼ˆ2MBé™åˆ¶ï¼‰
- å›¾ç‰‡ç±»å‹éªŒè¯ï¼ˆæ”¯æŒjpgã€pngã€gifç­‰ï¼‰
- ç»Ÿä¸€çš„é”™è¯¯æç¤º
- el-uploadé…ç½®ç”Ÿæˆ

**ä¸»è¦æ–¹æ³•ï¼š**
```javascript
// æœ€å¤§æ–‡ä»¶å¤§å°ï¼š2MB
export const MAX_FILE_SIZE = 2 * 1024 * 1024

// å®Œæ•´çš„æ–‡ä»¶éªŒè¯
export function validateUploadFile(file) {
  if (!file) {
    return { valid: false, message: 'è¯·é€‰æ‹©æ–‡ä»¶' }
  }
  
  if (!validateFileSize(file)) {
    return { 
      valid: false, 
      message: `æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MBï¼Œå½“å‰å¤§å°ï¼š${formatFileSize(file.size)}` 
    }
  }
  
  if (!validateImageType(file)) {
    return { 
      valid: false, 
      message: `åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œå½“å‰ç±»å‹ï¼š${file.type || 'æœªçŸ¥'}` 
    }
  }
  
  return { valid: true, message: 'éªŒè¯é€šè¿‡' }
}
```

### 3. å‰ç«¯ç»„ä»¶ä¿®æ”¹

#### 3.1 ç”¨æˆ·å¤´åƒä¸Šä¼ 
**æ–‡ä»¶ï¼š** `src/views/person/info/index.vue`

**ä¿®æ”¹å†…å®¹ï¼š**
```javascript
import { validateUploadFile, formatFileSize } from "@/utils/upload";

beforeAvatarUpload(file) {
  // â­ ä½¿ç”¨ç»Ÿä¸€çš„æ–‡ä»¶éªŒè¯
  const validation = validateUploadFile(file);
  if (!validation.valid) {
    this.$message.error(validation.message);
    return false;
  }
  
  // ... åŸæœ‰å›¾ç‰‡å¤„ç†é€»è¾‘
}
```

#### 3.2 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
**æ–‡ä»¶ï¼š** `src/components/RichTextEditor.vue`

**ä¿®æ”¹å†…å®¹ï¼š**
```javascript
import { validateUploadFile } from '@/utils/upload'

props: {
    fileSize: {
        type: Number,
        default: 2  // é»˜è®¤2MB
    }
}

handleBeforeUpload(file) {
    // â­ ä½¿ç”¨ç»Ÿä¸€çš„æ–‡ä»¶éªŒè¯
    const validation = validateUploadFile(file);
    if (!validation.valid) {
        this.$message.error(validation.message);
        return false;
    }
    
    this.isUploading = true
    return true
}
```

#### 3.3 Quillç¼–è¾‘å™¨ç»„ä»¶
**æ–‡ä»¶ï¼š** `src/components/Editor/index.vue`

**ä¿®æ”¹å†…å®¹ï¼š**
```javascript
import { validateUploadFile } from "@/utils/upload";

handleBeforeUpload(file) {
    // â­ ä½¿ç”¨ç»Ÿä¸€çš„æ–‡ä»¶éªŒè¯
    const validation = validateUploadFile(file);
    if (!validation.valid) {
        this.$message.error(validation.message);
        return false;
    }
    return true;
}
```

### 4. Spring Booté…ç½®ï¼ˆå¯é€‰ï¼‰

#### æœåŠ¡å™¨çº§åˆ«é™åˆ¶
åœ¨ `application.yml` ä¸­é…ç½®ï¼š
```yaml
spring:
  servlet:
    multipart:
      max-file-size: 2MB      # å•ä¸ªæ–‡ä»¶æœ€å¤§2MB
      max-request-size: 10MB  # è¯·æ±‚æœ€å¤§10MBï¼ˆæ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼‰
```

**æ³¨æ„ï¼š** è¿™æ˜¯æœåŠ¡å™¨çº§åˆ«çš„ç¡¬é™åˆ¶ï¼Œæˆ‘ä»¬çš„ä»£ç é™åˆ¶æ˜¯åº”ç”¨çº§åˆ«çš„è½¯é™åˆ¶ï¼Œæä¾›æ›´å‹å¥½çš„é”™è¯¯æç¤ºã€‚

## æ¶‰åŠåŠŸèƒ½æ¨¡å—

### âœ… å·²å®æ–½çš„åŠŸèƒ½
1. **ç”¨æˆ·å¤´åƒä¸Šä¼ ** - ä¸ªäººä¿¡æ¯é¡µ
2. **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å›¾ç‰‡** - è®ºå›å‘å¸–ã€çŸ¥è¯†ç‚¹ç¼–è¾‘
3. **Quillç¼–è¾‘å™¨å›¾ç‰‡** - å…¶ä»–ç¼–è¾‘å™¨åœºæ™¯
4. **é€šç”¨ä¸Šä¼ æ¥å£** - æ‰€æœ‰è°ƒç”¨ `/common/upload` çš„åŠŸèƒ½

### ğŸ“ è¦†ç›–çš„ä½¿ç”¨åœºæ™¯
- ç”¨æˆ·å¤´åƒæ›´æ–°
- è®ºå›å¸–å­å›¾ç‰‡
- çŸ¥è¯†ç‚¹å†…å®¹å›¾ç‰‡
- ç”¨æˆ·åé¦ˆæˆªå›¾
- è¯•å·ç­”æ¡ˆå›¾ç‰‡
- å…¶ä»–æ‰€æœ‰å›¾ç‰‡ä¸Šä¼ åœºæ™¯

## é”™è¯¯æç¤ºä¼˜åŒ–

### åç«¯é”™è¯¯ä¿¡æ¯
```json
// æ–‡ä»¶è¿‡å¤§
{
  "code": 500,
  "msg": "æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MBï¼Œå½“å‰æ–‡ä»¶å¤§å°ï¼š3.2MB"
}

// æ–‡ä»¶ç±»å‹é”™è¯¯
{
  "code": 500,
  "msg": "åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶ï¼Œå½“å‰æ–‡ä»¶ç±»å‹ï¼šapplication/pdf"
}
```

### å‰ç«¯é”™è¯¯æç¤º
- ä½¿ç”¨Element UIçš„ `$message.error()` æ˜¾ç¤ºå‹å¥½æç¤º
- åŒ…å«å½“å‰æ–‡ä»¶å¤§å°å’Œé™åˆ¶è¯´æ˜
- æç¤ºæ”¯æŒçš„æ–‡ä»¶æ ¼å¼

## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç”¨ä¾‹
1. **æ­£å¸¸å›¾ç‰‡ä¸Šä¼ **
   - 1MBçš„jpgå›¾ç‰‡ â†’ åº”è¯¥æˆåŠŸ âœ…
   - 500KBçš„pngå›¾ç‰‡ â†’ åº”è¯¥æˆåŠŸ âœ…

2. **å¤§æ–‡ä»¶æµ‹è¯•**
   - 3MBçš„å›¾ç‰‡ â†’ åº”è¯¥è¢«æ‹’ç»ï¼Œæ˜¾ç¤º"æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡2MB" âŒ
   - 5MBçš„å›¾ç‰‡ â†’ åº”è¯¥è¢«æ‹’ç» âŒ

3. **æ–‡ä»¶ç±»å‹æµ‹è¯•**
   - PDFæ–‡ä»¶ â†’ åº”è¯¥è¢«æ‹’ç»ï¼Œæ˜¾ç¤º"åªå…è®¸ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶" âŒ
   - Wordæ–‡æ¡£ â†’ åº”è¯¥è¢«æ‹’ç» âŒ
   - txtæ–‡ä»¶ â†’ åº”è¯¥è¢«æ‹’ç» âŒ

4. **è¾¹ç•Œæµ‹è¯•**
   - æ°å¥½2MBçš„å›¾ç‰‡ â†’ åº”è¯¥æˆåŠŸ âœ…
   - 2.1MBçš„å›¾ç‰‡ â†’ åº”è¯¥è¢«æ‹’ç» âŒ

### æµ‹è¯•æ­¥éª¤
1. **ç”¨æˆ·å¤´åƒä¸Šä¼ æµ‹è¯•**
   ```
   ä¸ªäººä¿¡æ¯é¡µ â†’ ç‚¹å‡»å¤´åƒ â†’ é€‰æ‹©å¤§æ–‡ä»¶ â†’ æŸ¥çœ‹æç¤º
   ```

2. **å¯Œæ–‡æœ¬ç¼–è¾‘å™¨æµ‹è¯•**
   ```
   è®ºå›å‘å¸– â†’ æ’å…¥å›¾ç‰‡ â†’ é€‰æ‹©å¤§æ–‡ä»¶ â†’ æŸ¥çœ‹æç¤º
   ```

3. **æ‰¹é‡ä¸Šä¼ æµ‹è¯•**
   ```
   é€‰æ‹©å¤šä¸ªæ–‡ä»¶ï¼ˆåŒ…å«å¤§æ–‡ä»¶ï¼‰â†’ æŸ¥çœ‹é”™è¯¯æç¤º
   ```

## æŠ€æœ¯ä¼˜åŠ¿

### 1. **åŒé‡ä¿æŠ¤**
- å‰ç«¯éªŒè¯ï¼šç”¨æˆ·ä½“éªŒå¥½ï¼Œå³æ—¶æç¤º
- åç«¯éªŒè¯ï¼šå®‰å…¨å¯é ï¼Œé˜²æ­¢ç»•è¿‡

### 2. **ç»Ÿä¸€ç®¡ç†**
- å·¥å…·å‡½æ•°ç»Ÿä¸€ï¼š`src/utils/upload.js`
- é™åˆ¶é…ç½®ç»Ÿä¸€ï¼šæ‰€æœ‰åœ°æ–¹éƒ½æ˜¯2MB
- é”™è¯¯æç¤ºç»Ÿä¸€ï¼šæ ¼å¼ä¸€è‡´çš„å‹å¥½æç¤º

### 3. **æ˜“äºç»´æŠ¤**
- ä¿®æ”¹é™åˆ¶å¤§å°ï¼šåªéœ€æ”¹ `MAX_FILE_SIZE` å¸¸é‡
- æ·»åŠ æ”¯æŒæ ¼å¼ï¼šåªéœ€ä¿®æ”¹ `ALLOWED_IMAGE_TYPES` æ•°ç»„
- æ–°å¢ä¸Šä¼ åŠŸèƒ½ï¼šç›´æ¥å¯¼å…¥ `validateUploadFile` ä½¿ç”¨

### 4. **å‘åå…¼å®¹**
- ä¸å½±å“ç°æœ‰åŠŸèƒ½
- æ¸è¿›å¼æ”¹è¿›
- ä¿æŒAPIæ¥å£ä¸å˜

## æ€§èƒ½å½±å“

### âœ… ç§¯æå½±å“
- **å‡å°‘æœåŠ¡å™¨å‹åŠ›**ï¼šå¤§æ–‡ä»¶åœ¨å‰ç«¯è¢«æ‹¦æˆª
- **èŠ‚çœOSSè´¹ç”¨**ï¼šé¿å…æ— æ•ˆå¤§æ–‡ä»¶ä¸Šä¼ 
- **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šå³æ—¶åé¦ˆï¼Œæ— éœ€ç­‰å¾…ä¸Šä¼ å¤±è´¥

### âš ï¸ æ³¨æ„äº‹é¡¹
- **æ–‡ä»¶éªŒè¯å¼€é”€**ï¼šå‰ç«¯éªŒè¯å‡ ä¹æ— å¼€é”€
- **å…¼å®¹æ€§è€ƒè™‘**ï¼šFile APIåœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­éƒ½æ”¯æŒ
- **ç”¨æˆ·æ•™è‚²**ï¼šå¯ä»¥åœ¨UIä¸­æç¤ºæ–‡ä»¶å¤§å°è¦æ±‚

## åç»­ä¼˜åŒ–å»ºè®®

### 1. **å›¾ç‰‡å‹ç¼©**
å¯¹äºè¶…è¿‡2MBçš„å›¾ç‰‡ï¼Œå¯ä»¥è€ƒè™‘ï¼š
- å‰ç«¯è‡ªåŠ¨å‹ç¼©ï¼ˆå·²åœ¨å¤´åƒä¸Šä¼ ä¸­å®ç°ï¼‰
- æç¤ºç”¨æˆ·ä½¿ç”¨å‹ç¼©å·¥å…·
- æä¾›åœ¨çº¿å‹ç¼©åŠŸèƒ½

### 2. **è¿›åº¦æç¤º**
- ä¸Šä¼ è¿›åº¦æ¡
- å‹ç¼©è¿›åº¦æç¤º
- æ‰¹é‡ä¸Šä¼ çŠ¶æ€

### 3. **æ ¼å¼è½¬æ¢**
- è‡ªåŠ¨è½¬æ¢HEICç­‰è‹¹æœæ ¼å¼
- ç»Ÿä¸€è½¬æ¢ä¸ºwebpæ ¼å¼ï¼ˆæ›´å°ä½“ç§¯ï¼‰

### 4. **æ™ºèƒ½å»ºè®®**
- æ ¹æ®å›¾ç‰‡ç”¨é€”æ¨èåˆé€‚å°ºå¯¸
- æä¾›æœ€ä½³å‹ç¼©å»ºè®®
- æ‰¹é‡å¤„ç†å·¥å…·

## æ€»ç»“

æœ¬æ¬¡å®æ–½å®Œæˆäº†å…¨ç«™å›¾ç‰‡ä¸Šä¼ çš„2MBé™åˆ¶ï¼ŒåŒ…æ‹¬ï¼š

### âœ… å·²å®Œæˆ
- åç«¯æ¥å£é™åˆ¶ï¼ˆå•æ–‡ä»¶+æ‰¹é‡ï¼‰
- å‰ç«¯ç»Ÿä¸€éªŒè¯å·¥å…·
- æ‰€æœ‰ä¸Šä¼ ç»„ä»¶æ”¹é€ 
- å‹å¥½çš„é”™è¯¯æç¤º
- è¯¦ç»†çš„å®æ–½æ–‡æ¡£

### ğŸ“ˆ æ•ˆæœé¢„æœŸ
- **å®‰å…¨æ€§æå‡**ï¼šé˜²æ­¢å¤§æ–‡ä»¶æ”»å‡»
- **æˆæœ¬æ§åˆ¶**ï¼šå‡å°‘OSSå­˜å‚¨è´¹ç”¨
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå‡å°‘æ— æ•ˆä¸Šä¼ 
- **ç”¨æˆ·ä½“éªŒ**ï¼šå³æ—¶å‹å¥½åé¦ˆ

### ğŸ¯ æ ¸å¿ƒä»·å€¼
é€šè¿‡ç»Ÿä¸€çš„2MBé™åˆ¶ï¼Œåœ¨ä¿è¯åŠŸèƒ½å¯ç”¨æ€§çš„åŒæ—¶ï¼Œæœ‰æ•ˆæ§åˆ¶äº†ç³»ç»Ÿèµ„æºæ¶ˆè€—å’Œå­˜å‚¨æˆæœ¬ï¼Œæå‡äº†æ•´ä½“çš„ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿç¨³å®šæ€§ã€‚

---

**å®æ–½äººå‘˜ï¼š** Cascade AI  
**ç”Ÿæ•ˆæ—¥æœŸï¼š** 2025-11-29  
**é€‚ç”¨èŒƒå›´ï¼š** å…¨ç«™å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
