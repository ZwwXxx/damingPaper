# æŒ‰è¯•å·åˆ†ç±»ç»Ÿè®¡ä¼˜åŒ–è¯´æ˜

## ğŸ“‹ ä¼˜åŒ–èƒŒæ™¯

åœ¨åŸå§‹è®¾è®¡ä¸­ï¼Œè€ƒè¯•è¶‹åŠ¿ç»Ÿè®¡ä½¿ç”¨äº†**å…¨å±€å¹³å‡åˆ†**ï¼Œä½†è¿™ç§ç»Ÿè®¡æ–¹å¼å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

### âŒ åŸæœ‰é—®é¢˜
1. **ä¸åŒè¯•å·æ€»åˆ†ä¸åŒ**ï¼šæœ‰çš„è¯•å·100åˆ†ï¼Œæœ‰çš„150åˆ†ï¼Œç›´æ¥ç»Ÿè®¡å¹³å‡åˆ†æ²¡æœ‰å¯æ¯”æ€§
2. **æ··åˆç»Ÿè®¡æ— æ„ä¹‰**ï¼šå°†ä¸åŒè¯•å·çš„åˆ†æ•°æ··åœ¨ä¸€èµ·æ±‚å¹³å‡ï¼Œæ•°æ®å¤±å»å®é™…æ„ä¹‰
3. **æ— æ³•åæ˜ çœŸå®æƒ…å†µ**ï¼šç®¡ç†å‘˜æ— æ³•äº†è§£å…·ä½“å“ªä¸ªè¯•å·çš„è€ƒè¯•æƒ…å†µå¦‚ä½•

---

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### æ”¹è¿›æ€è·¯
å°†**å…¨å±€æ··åˆç»Ÿè®¡**æ”¹ä¸º**æŒ‰è¯•å·åˆ†ç±»ç»Ÿè®¡**ï¼Œè®©æ¯ä¸ªè¯•å·çš„æ•°æ®ç‹¬ç«‹å±•ç¤ºã€‚

### ç»Ÿè®¡ç»´åº¦è°ƒæ•´

#### ä¿ç•™çš„å…¨å±€ç»Ÿè®¡
- âœ… **è€ƒè¯•äººæ¬¡è¶‹åŠ¿**ï¼ˆæŒ‰æ—¥æœŸï¼‰- å…¨å±€è¶‹åŠ¿æœ‰æ„ä¹‰
- âœ… **åŠæ ¼ç‡**ï¼ˆ60åˆ†çº¿ï¼‰ - ä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œæœ‰ç»Ÿè®¡æ„ä¹‰
- âœ… **ä¼˜ç§€ç‡**ï¼ˆ85åˆ†çº¿ï¼‰- ä½¿ç”¨ç™¾åˆ†æ¯”ï¼Œæœ‰ç»Ÿè®¡æ„ä¹‰
- âœ… **æ‰¹æ”¹è¿›åº¦** - å…¨å±€è¿›åº¦

#### æ–°å¢çš„è¯•å·åˆ†ç±»ç»Ÿè®¡
- âœ… **æŒ‰è¯•å·ç»Ÿè®¡è€ƒè¯•äººæ¬¡** - äº†è§£å“ªäº›è¯•å·æœ€çƒ­é—¨
- âœ… **æŒ‰è¯•å·ç»Ÿè®¡å¹³å‡åˆ†** - åŸå§‹åˆ†æ•°ï¼ˆå¦‚ï¼š78.5 / 100ï¼‰
- âœ… **æŒ‰è¯•å·ç»Ÿè®¡å¹³å‡å¾—åˆ†ç‡** - ç™¾åˆ†æ¯”ï¼ˆå¦‚ï¼š78.5%ï¼‰
- âœ… **æ˜¾ç¤ºè¯•å·æ€»åˆ†** - ä¾¿äºç†è§£åˆ†æ•°å«ä¹‰

---

## ğŸ”§ ä»£ç ä¿®æ”¹å†…å®¹

### 1. Mapperæ¥å£ (DashboardMapper.java)

**æ–°å¢æ–¹æ³•**:
```java
/**
 * æŒ‰è¯•å·ç»Ÿè®¡è€ƒè¯•è¶‹åŠ¿ï¼ˆæœ€è¿‘Nå¤©çš„çƒ­é—¨è¯•å·ï¼‰
 */
List<Map<String, Object>> getExamTrendByPaper(@Param("days") Integer days, @Param("limit") Integer limit);
```

### 2. Mapper XML (DashboardMapper.xml)

**æ–°å¢SQLæŸ¥è¯¢**:
```xml
<!-- æŒ‰è¯•å·ç»Ÿè®¡è€ƒè¯•è¶‹åŠ¿ï¼ˆæœ€è¿‘Nå¤©çš„çƒ­é—¨è¯•å·ï¼‰ -->
<select id="getExamTrendByPaper" resultType="java.util.HashMap">
    SELECT
        p.paper_id AS paperId,
        p.paper_name AS paperName,
        COUNT(pa.paper_answer_id) AS examCount,
        ROUND(AVG(pa.final_score * 100.0 / pa.paper_score), 2) AS avgScorePercent,
        ROUND(AVG(pa.final_score), 2) AS avgScore,
        MAX(pa.paper_score) AS totalScore
    FROM daming_paper p
    INNER JOIN daming_paper_answer pa ON p.paper_id = pa.paper_id
    WHERE pa.create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
      AND p.del_flag = 0
    GROUP BY p.paper_id, p.paper_name
    ORDER BY examCount DESC
    LIMIT #{limit}
</select>
```

**ä¿®æ”¹è€ƒè¯•è¶‹åŠ¿æŸ¥è¯¢**:
```xml
<!-- åªç»Ÿè®¡è€ƒè¯•äººæ¬¡ï¼Œä¸å†è®¡ç®—å…¨å±€å¹³å‡åˆ† -->
<select id="getExamTrend" resultType="java.util.HashMap">
    SELECT
        DATE_FORMAT(create_time, '%Y-%m-%d') AS date,
        COUNT(*) AS count
    FROM daming_paper_answer
    WHERE create_time >= DATE_SUB(CURDATE(), INTERVAL #{days} DAY)
    GROUP BY DATE_FORMAT(create_time, '%Y-%m-%d')
    ORDER BY date ASC
</select>
```

### 3. DTOç±» (ExamStatisticsDto.java)

**åˆ é™¤å­—æ®µ**:
```java
// åˆ é™¤å…¨å±€å¹³å‡åˆ†
// private Double avgScore;
```

**æ–°å¢å†…éƒ¨ç±»**:
```java
/**
 * æŒ‰è¯•å·åˆ†ç±»çš„è€ƒè¯•ç»Ÿè®¡æ•°æ®
 */
public static class PaperExamStatDto {
    /** è¯•å·ID */
    private Long paperId;
    
    /** è¯•å·åç§° */
    private String paperName;
    
    /** è€ƒè¯•äººæ¬¡ */
    private Long examCount;
    
    /** å¹³å‡åˆ†ï¼ˆåŸå§‹åˆ†ï¼‰ */
    private Double avgScore;
    
    /** å¹³å‡åˆ†ç™¾åˆ†æ¯” */
    private Double avgScorePercent;
    
    /** è¯•å·æ€»åˆ† */
    private Integer totalScore;
    
    // getterå’Œsetteræ–¹æ³•...
}
```

**æ–°å¢å­—æ®µ**:
```java
/** æŒ‰è¯•å·åˆ†ç±»çš„è€ƒè¯•ç»Ÿè®¡ */
private List<PaperExamStatDto> paperExamStats;
```

**ä¿®æ”¹ExamTrendDto**:
```java
// åˆ é™¤avgScoreå­—æ®µï¼Œåªä¿ç•™dateå’Œcount
public static class ExamTrendDto {
    private String date;
    private Long count;
}
```

### 4. Serviceå®ç° (DashboardServiceImpl.java)

**åˆ é™¤ä»£ç **:
```java
// åˆ é™¤å…¨å±€å¹³å‡åˆ†ç»Ÿè®¡
// Double avgScore = dashboardMapper.getAvgScore();
// dto.setAvgScore(avgScore != null ? avgScore : 0.0);
```

**æ–°å¢ä»£ç **:
```java
// æŒ‰è¯•å·åˆ†ç±»çš„è€ƒè¯•ç»Ÿè®¡(æœ€è¿‘30å¤©çƒ­é—¨è¯•å·TOP5)
List<Map<String, Object>> paperData = dashboardMapper.getExamTrendByPaper(30, 5);
List<PaperExamStatDto> paperExamStats = new ArrayList<>();
for (Map<String, Object> data : paperData) {
    PaperExamStatDto stat = new PaperExamStatDto();
    stat.setPaperId(((Number) data.get("paperId")).longValue());
    stat.setPaperName((String) data.get("paperName"));
    stat.setExamCount(((Number) data.get("examCount")).longValue());
    Object avgScoreObj = data.get("avgScore");
    stat.setAvgScore(avgScoreObj != null ? ((Number) avgScoreObj).doubleValue() : 0.0);
    Object avgScorePercentObj = data.get("avgScorePercent");
    stat.setAvgScorePercent(avgScorePercentObj != null ? ((Number) avgScorePercentObj).doubleValue() : 0.0);
    Object totalScoreObj = data.get("totalScore");
    stat.setTotalScore(totalScoreObj != null ? ((Number) totalScoreObj).intValue() : 100);
    paperExamStats.add(stat);
}
dto.setPaperExamStats(paperExamStats);
```

### 5. å‰ç«¯é¡µé¢ (ruoyi-ui/src/views/dashboard/index.vue)

**æ–°å¢è¡¨æ ¼å±•ç¤º**:
```vue
<el-row :gutter="20" class="chart-row">
  <!-- æŒ‰è¯•å·åˆ†ç±»çš„è€ƒè¯•ç»Ÿè®¡ -->
  <el-col :xs="24" :sm="24" :md="24" :lg="24" :xl="24">
    <div class="chart-card">
      <div class="chart-header">
        <h3 class="chart-title">çƒ­é—¨è¯•å·è€ƒè¯•ç»Ÿè®¡</h3>
        <el-tag size="small" type="warning">æœ€è¿‘30å¤© TOP5</el-tag>
      </div>
      <div class="chart-body">
        <el-table :data="examData.paperExamStats" style="width: 100%">
          <el-table-column type="index" label="æ’å" width="60" align="center" />
          <el-table-column prop="paperName" label="è¯•å·åç§°" min-width="200" />
          <el-table-column prop="examCount" label="è€ƒè¯•äººæ¬¡" width="120" align="center" sortable />
          <el-table-column prop="avgScore" label="å¹³å‡åˆ†" width="150" align="center">
            <template slot-scope="scope">
              <span>{{ scope.row.avgScore }} / {{ scope.row.totalScore }}</span>
            </template>
          </el-table-column>
          <el-table-column prop="avgScorePercent" label="å¹³å‡å¾—åˆ†ç‡" width="150" align="center" sortable>
            <template slot-scope="scope">
              <el-progress 
                :percentage="scope.row.avgScorePercent" 
                :color="getScorePercentColor(scope.row.avgScorePercent)"
              ></el-progress>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </div>
  </el-col>
</el-row>
```

**ä¿®æ”¹è€ƒè¯•è¶‹åŠ¿å›¾**:
```javascript
// ç®€åŒ–ä¸ºåªæ˜¾ç¤ºè€ƒè¯•äººæ¬¡çš„æŸ±çŠ¶å›¾
renderExamTrendChart() {
  const option = {
    // åªæ˜¾ç¤ºè€ƒè¯•äººæ¬¡ï¼Œä¸å†æ˜¾ç¤ºå¹³å‡åˆ†
    series: [{
      name: 'è€ƒè¯•äººæ¬¡',
      type: 'bar',
      data: examTrend.map(item => item.count)
    }]
  }
}
```

**æ–°å¢æ–¹æ³•**:
```javascript
// æ ¹æ®å¾—åˆ†ç‡è¿”å›è¿›åº¦æ¡é¢œè‰²
getScorePercentColor(percent) {
  if (percent >= 85) return '#67C23A'  // ç»¿è‰²-ä¼˜ç§€
  if (percent >= 60) return '#409EFF'  // è“è‰²-åŠæ ¼
  return '#F56C6C'  // çº¢è‰²-ä¸åŠæ ¼
}
```

---

## ğŸ“Š æ•°æ®å±•ç¤ºæ•ˆæœ

### åŸæ¥ï¼ˆâŒ æœ‰é—®é¢˜ï¼‰
```
å…¨å±€å¹³å‡åˆ†: 78.5åˆ†  â† æ··åˆäº†ä¸åŒæ€»åˆ†çš„è¯•å·ï¼Œæ— æ„ä¹‰
```

### ç°åœ¨ï¼ˆâœ… åˆç†ï¼‰
```
çƒ­é—¨è¯•å·è€ƒè¯•ç»Ÿè®¡ï¼ˆæœ€è¿‘30å¤© TOP5ï¼‰
â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æ’åâ”‚ è¯•å·åç§°          â”‚è€ƒè¯•äººæ¬¡â”‚ å¹³å‡åˆ†   â”‚ å¹³å‡å¾—åˆ†ç‡â”‚
â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â”‚è®¡ç®—æœºç»„æˆæœŸä¸­è€ƒè¯•  â”‚ 320  â”‚ 78.5/100â”‚ â–ˆâ–ˆâ–ˆâ–ˆ78.5%â”‚
â”‚ 2  â”‚è½¯ä»¶å·¥ç¨‹æœŸæœ«è€ƒè¯•    â”‚ 250  â”‚112.5/150â”‚ â–ˆâ–ˆâ–ˆâ–ˆ75.0%â”‚
â”‚ 3  â”‚æ•°æ®ç»“æ„åŸºç¡€æµ‹è¯•    â”‚ 180  â”‚ 65.2/80 â”‚ â–ˆâ–ˆâ–ˆâ–ˆ81.5%â”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®è¯´æ˜
- **è€ƒè¯•äººæ¬¡**: æ˜¾ç¤ºè¯¥è¯•å·çš„å—æ¬¢è¿ç¨‹åº¦
- **å¹³å‡åˆ†**: æ˜¾ç¤ºåŸå§‹åˆ†æ•°å’Œæ€»åˆ†ï¼ˆå¦‚ï¼š78.5 / 100ï¼‰
- **å¹³å‡å¾—åˆ†ç‡**: æ ‡å‡†åŒ–ç™¾åˆ†æ¯”ï¼Œæ–¹ä¾¿ä¸åŒè¯•å·é—´å¯¹æ¯”
- **è¿›åº¦æ¡é¢œè‰²**: 
  - ğŸŸ¢ ç»¿è‰²ï¼ˆâ‰¥85%ï¼‰ï¼šä¼˜ç§€
  - ğŸ”µ è“è‰²ï¼ˆ60%-85%ï¼‰ï¼šåŠæ ¼
  - ğŸ”´ çº¢è‰²ï¼ˆ<60%ï¼‰ï¼šä¸åŠæ ¼

---

## ğŸ¯ ä¼˜åŒ–æ”¶ç›Š

### 1. æ•°æ®æ›´æœ‰æ„ä¹‰
- âœ… æ¯ä¸ªè¯•å·çš„ç»Ÿè®¡æ•°æ®ç‹¬ç«‹å±•ç¤º
- âœ… ä½¿ç”¨å¾—åˆ†ç‡ï¼ˆç™¾åˆ†æ¯”ï¼‰ä¾¿äºä¸åŒè¯•å·é—´å¯¹æ¯”
- âœ… ä¿ç•™åŸå§‹åˆ†æ•°ä¾¿äºäº†è§£å®é™…æƒ…å†µ

### 2. ä¾¿äºç®¡ç†å†³ç­–
- âœ… å‘ç°å“ªäº›è¯•å·æœ€å—æ¬¢è¿
- âœ… å‘ç°å“ªäº›è¯•å·éš¾åº¦è¿‡é«˜/è¿‡ä½
- âœ… åŠæ—¶è°ƒæ•´è¯•å·è®¾ç½®

### 3. ç»Ÿè®¡æ›´ç§‘å­¦
- âœ… é¿å…ä¸åŒæ€»åˆ†è¯•å·çš„æ··åˆç»Ÿè®¡
- âœ… ä½¿ç”¨æ ‡å‡†åŒ–æŒ‡æ ‡ï¼ˆå¾—åˆ†ç‡ï¼‰è¿›è¡Œå¯¹æ¯”
- âœ… ä¿æŒå…¨å±€ç»Ÿè®¡ï¼ˆè€ƒè¯•äººæ¬¡ã€åŠæ ¼ç‡ï¼‰çš„åˆç†æ€§

---

## ğŸš€ éƒ¨ç½²è¯´æ˜

### éœ€è¦é‡æ–°ç¼–è¯‘
```bash
# åç«¯
cd daming-admin
mvn clean package -DskipTests

# å‰ç«¯
cd ruoyi-ui
npm run build:prod
```

### éœ€è¦é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯æœåŠ¡
./ry.sh restart

# é‡å¯å‰ç«¯
nginx -s reload
```

### APIè¿”å›æ•°æ®ç¤ºä¾‹
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "todayExams": 156,
    "weekExams": 820,
    "monthExams": 2340,
    "passRate": 85.2,
    "excellentRate": 32.6,
    "examTrend": [
      {"date": "2025-10-23", "count": 45},
      {"date": "2025-10-24", "count": 52}
    ],
    "paperExamStats": [
      {
        "paperId": 25,
        "paperName": "è®¡ç®—æœºç»„æˆæœŸä¸­è€ƒè¯•",
        "examCount": 320,
        "avgScore": 78.5,
        "avgScorePercent": 78.5,
        "totalScore": 100
      },
      {
        "paperId": 18,
        "paperName": "è½¯ä»¶å·¥ç¨‹æœŸæœ«è€ƒè¯•",
        "examCount": 250,
        "avgScore": 112.5,
        "avgScorePercent": 75.0,
        "totalScore": 150
      }
    ],
    "reviewProgress": {
      "pending": 45,
      "reviewed": 180,
      "rate": 80.0
    }
  }
}
```

---

## ğŸ“ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å°†**æ— æ„ä¹‰çš„å…¨å±€å¹³å‡åˆ†ç»Ÿè®¡**æ”¹ä¸º**æŒ‰è¯•å·åˆ†ç±»çš„è¯¦ç»†ç»Ÿè®¡**ï¼Œè®©æ•°æ®æ›´æœ‰å®é™…æ„ä¹‰ï¼Œä¾¿äºç®¡ç†å‘˜åšå‡ºåˆç†å†³ç­–ã€‚

**æ ¸å¿ƒæ”¹è¿›**ï¼š
1. âŒ åˆ é™¤å…¨å±€å¹³å‡åˆ†ï¼ˆä¸åŒæ€»åˆ†æ— æ³•æ¯”è¾ƒï¼‰
2. âœ… æ–°å¢æŒ‰è¯•å·ç»Ÿè®¡ï¼ˆæ˜¾ç¤ºåŸå§‹åˆ†å’Œå¾—åˆ†ç‡ï¼‰
3. âœ… ä½¿ç”¨è¿›åº¦æ¡å¯è§†åŒ–å¾—åˆ†ç‡
4. âœ… ä¿ç•™åˆç†çš„å…¨å±€ç»Ÿè®¡ï¼ˆè€ƒè¯•äººæ¬¡ã€åŠæ ¼ç‡ï¼‰

---

**ä¼˜åŒ–å®Œæˆæ—¥æœŸ**: 2025-11-22  
**ä¼˜åŒ–äººå‘˜**: Cascade
