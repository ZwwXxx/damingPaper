# 后台首页报表规划文档

## 一、概述

### 1.1 功能定位
后台首页报表旨在为管理员提供系统运营核心数据的可视化展示,帮助管理员快速了解系统整体运行状况、用户活跃度、考试数据等关键指标。

### 1.2 设计原则
- **数据准确性**: 确保统计数据的准确性和实时性
- **性能优化**: 采用缓存机制,避免复杂查询影响系统性能
- **视觉友好**: 采用图表和卡片式布局,信息层次清晰
- **响应式设计**: 适配不同屏幕尺寸,提供良好的用户体验

---

## 二、数据统计模块规划

### 2.1 核心数据卡片统计
展示系统的核心业务数据,以卡片形式呈现在页面顶部。

| 统计项 | 数据来源 | 计算逻辑 | 对比维度 |
|--------|----------|----------|----------|
| 总用户数 | `sys_user` | 统计 `del_flag='0'` 的用户总数 | 对比昨日新增 |
| 总题目数 | `daming_question` | 统计 `del_flag=0` 的题目总数 | 对比昨日新增 |
| 总试卷数 | `daming_paper` | 统计 `del_flag=0` 的试卷总数 | 对比昨日新增 |
| 总考试次数 | `daming_paper_answer` | 统计答卷记录总数 | 对比昨日新增 |

**技术要点**:
- 使用 Redis 缓存统计结果,设置5分钟过期时间
- 对比数据通过日期范围查询计算
- 显示增长率和趋势图标(上升/下降)

---

### 2.2 用户活跃度分析
分析用户的活跃情况,帮助了解用户粘性。

#### 2.2.1 用户登录统计
| 统计项 | 数据来源 | 计算逻辑 |
|--------|----------|----------|
| 今日登录用户数 | `sys_logininfor` | 统计今日 `status='0'` 的唯一用户数 |
| 本周登录用户数 | `sys_logininfor` | 统计本周 `status='0'` 的唯一用户数 |
| 本月登录用户数 | `sys_logininfor` | 统计本月 `status='0'` 的唯一用户数 |
| 本月新增用户数 | `sys_user` | 统计本月新创建的用户数 |

#### 2.2.2 登录趋势图
- **图表类型**: 折线图
- **时间维度**: 最近30天
- **数据来源**: `sys_logininfor`
- **统计指标**: 每日登录人次、每日唯一登录用户数

---

### 2.3 考试数据分析
核心业务数据统计,反映系统使用情况。

#### 2.3.1 考试次数统计
| 统计项 | 数据来源 | 计算逻辑 |
|--------|----------|----------|
| 今日考试人次 | `daming_paper_answer` | 统计今日创建的答卷数 |
| 本周考试人次 | `daming_paper_answer` | 统计本周创建的答卷数 |
| 本月考试人次 | `daming_paper_answer` | 统计本月创建的答卷数 |

#### 2.3.2 考试成绩分析
| 统计项 | 数据来源 | 计算逻辑 |
|--------|----------|----------|
| 平均分 | `daming_paper_answer` | 计算 `final_score` 的平均值 |
| 及格率 | `daming_paper_answer` | 计算及格人数占比(60分及以上) |
| 优秀率 | `daming_paper_answer` | 计算优秀人数占比(85分及以上) |

#### 2.3.3 考试趋势图
- **图表类型**: 柱状图 + 折线图组合
- **时间维度**: 最近30天
- **数据来源**: `daming_paper_answer`
- **统计指标**: 每日考试人次(柱状图)、每日平均分(折线图)

#### 2.3.4 批改进度统计
| 统计项 | 数据来源 | 计算逻辑 |
|--------|----------|----------|
| 待批改数 | `daming_paper_answer` | 统计 `review_status=1` 的答卷数 |
| 已批改数 | `daming_paper_answer` | 统计 `review_status=2` 的答卷数 |
| 批改率 | `daming_paper_answer` | 已批改数 / 需批改总数 * 100% |

**展示方式**: 环形进度图

---

### 2.4 题目相关统计

#### 2.4.1 科目题目分布
- **图表类型**: 饼图
- **数据来源**: `daming_question` JOIN `daming_subject`
- **统计维度**: 按科目统计题目数量

#### 2.4.2 题型分布
- **图表类型**: 柱状图
- **数据来源**: `daming_question`
- **统计维度**: 按 `question_type` 统计
- **题型映射**:
  - 1: 单选题
  - 2: 多选题
  - 3: 判断题
  - 4: 填空题
  - 5: 简答题

#### 2.4.3 热门收藏题目TOP10
- **数据来源**: `daming_question_favorite` JOIN `daming_question`
- **展示内容**: 题目ID、题目内容预览、收藏次数
- **排序规则**: 按收藏次数降序

---

### 2.5 试卷相关统计

#### 2.5.1 热门试卷TOP10
- **数据来源**: `daming_paper` JOIN `daming_paper_answer`
- **统计维度**: 按试卷统计考试人次
- **展示内容**: 试卷名称、考试人次、平均分、科目
- **排序规则**: 按考试人次降序

#### 2.5.2 试卷完成率分析
| 统计项 | 计算逻辑 |
|--------|----------|
| 已发布试卷数 | 统计所有未删除的试卷 |
| 有人参与的试卷数 | 统计至少有一次答卷的试卷数 |
| 试卷使用率 | 有人参与的试卷数 / 已发布试卷数 * 100% |

---

### 2.6 时间维度分析

#### 2.6.1 考试时间分布(24小时热力图)
- **图表类型**: 柱状图
- **时间维度**: 按小时统计
- **数据来源**: `daming_paper_answer`
- **统计指标**: 各时段考试人次
- **用途**: 分析用户使用习惯,优化系统维护时间

#### 2.6.2 系统操作活跃度
- **数据来源**: `sys_oper_log`
- **统计维度**: 最近7天的操作日志数量
- **展示方式**: 折线图

---

## 三、页面布局设计

### 3.1 布局结构
```
+----------------------------------------------------------+
|                     核心数据卡片区                          |
|  [总用户数] [总题目数] [总试卷数] [总考试次数]                |
+----------------------------------------------------------+
|                                                          |
|  [用户登录趋势图 - 折线图]    [考试趋势图 - 柱状+折线]      |
|                                                          |
+----------------------------------------------------------+
|                                                          |
|  [科目题目分布 - 饼图]        [题型分布 - 柱状图]          |
|                                                          |
+----------------------------------------------------------+
|                                                          |
|  [热门试卷TOP10 - 表格]                                   |
|                                                          |
+----------------------------------------------------------+
|                                                          |
|  [批改进度 - 环形图]          [考试时间分布 - 柱状图]      |
|                                                          |
+----------------------------------------------------------+
```

### 3.2 响应式适配
- **PC端**: 采用上述栅格布局
- **平板端**: 卡片2列展示,图表保持原有布局
- **移动端**: 卡片和图表均为单列堆叠展示

---

## 四、技术实现方案

### 4.1 后端技术栈
- **框架**: Spring Boot + MyBatis Plus
- **缓存**: Redis(统计数据缓存)
- **定时任务**: Quartz(定时刷新缓存数据)

### 4.2 前端技术栈
- **UI框架**: Element UI
- **图表库**: ECharts 5.x
- **HTTP客户端**: Axios

### 4.3 性能优化策略

#### 4.3.1 缓存策略
| 数据类型 | 缓存时长 | 刷新策略 |
|---------|---------|---------|
| 核心数据卡片 | 5分钟 | 定时刷新 + 手动刷新 |
| 趋势图数据 | 1小时 | 定时刷新 |
| TOP榜单 | 30分钟 | 定时刷新 |
| 实时数据(待批改) | 不缓存 | 每次查询 |

#### 4.3.2 数据库优化
- 为查询字段添加索引:
  - `sys_logininfor`: `login_time`, `user_name`
  - `daming_paper_answer`: `create_time`, `paper_id`, `create_user`
  - `daming_question_favorite`: `question_id`
- 使用分区表存储历史数据(按月分区)

#### 4.3.3 查询优化
- 使用覆盖索引减少回表查询
- 避免使用 `SELECT *`,只查询必要字段
- 大数据量统计使用预聚合表

---

## 五、接口设计

### 5.1 核心数据统计接口
```
GET /api/dashboard/overview
返回: {
  totalUsers: 1250,
  totalUsersGrowth: "+5.2%",
  totalQuestions: 5430,
  totalQuestionsGrowth: "+2.1%",
  totalPapers: 230,
  totalPapersGrowth: "+3.0%",
  totalExams: 12800,
  totalExamsGrowth: "+8.5%"
}
```

### 5.2 用户活跃度接口
```
GET /api/dashboard/user-activity
返回: {
  todayLogins: 120,
  weekLogins: 580,
  monthLogins: 1050,
  newUsers: 45,
  loginTrend: [
    { date: "2025-11-01", logins: 85, uniqueUsers: 62 },
    { date: "2025-11-02", logins: 92, uniqueUsers: 68 },
    ...
  ]
}
```

### 5.3 考试数据分析接口
```
GET /api/dashboard/exam-statistics
返回: {
  todayExams: 156,
  weekExams: 820,
  monthExams: 2340,
  avgScore: 78.5,
  passRate: 85.2,
  excellentRate: 32.6,
  examTrend: [
    { date: "2025-11-01", count: 45, avgScore: 76.8 },
    { date: "2025-11-02", count: 52, avgScore: 79.2 },
    ...
  ],
  reviewProgress: {
    pending: 45,
    reviewed: 180,
    rate: 80.0
  }
}
```

### 5.4 题目统计接口
```
GET /api/dashboard/question-statistics
返回: {
  subjectDistribution: [
    { subjectName: "计算机组成", count: 1250 },
    { subjectName: "软件工程", count: 980 },
    ...
  ],
  typeDistribution: [
    { type: 1, typeName: "单选题", count: 2100 },
    { type: 2, typeName: "多选题", count: 1580 },
    ...
  ],
  topFavorites: [
    { questionId: 123, preview: "操作系统中的进程...", favCount: 45 },
    ...
  ]
}
```

### 5.5 试卷统计接口
```
GET /api/dashboard/paper-statistics
返回: {
  topPapers: [
    { 
      paperId: 25, 
      paperName: "计算机组成期中考试", 
      examCount: 320, 
      avgScore: 81.5,
      subjectName: "计算机组成"
    },
    ...
  ],
  usageRate: 78.5,
  publishedCount: 230,
  usedCount: 181
}
```

### 5.6 时间分布接口
```
GET /api/dashboard/time-distribution
返回: {
  hourlyDistribution: [
    { hour: 0, count: 5 },
    { hour: 1, count: 2 },
    ...
    { hour: 23, count: 8 }
  ]
}
```

---

## 六、开发任务分解

### 6.1 后端开发任务

| 任务 | 描述 | 优先级 | 预估工时 |
|------|------|--------|----------|
| 数据库优化 | 添加必要索引,创建统计视图 | P0 | 2h |
| DTO/VO定义 | 定义接口响应对象 | P0 | 1h |
| Service实现 | 实现各统计方法 | P0 | 8h |
| Controller开发 | 创建API接口 | P0 | 2h |
| 缓存机制 | 集成Redis缓存 | P1 | 3h |
| 定时任务 | 定时刷新缓存数据 | P1 | 2h |
| 单元测试 | 编写核心方法单元测试 | P2 | 4h |

**总计**: 22小时

### 6.2 前端开发任务

| 任务 | 描述 | 优先级 | 预估工时 |
|------|------|--------|----------|
| 页面结构搭建 | 创建首页组件和布局 | P0 | 2h |
| API封装 | 封装接口调用方法 | P0 | 1h |
| 数据卡片组件 | 开发核心数据展示卡片 | P0 | 3h |
| 趋势图表组件 | 集成ECharts,开发趋势图 | P0 | 4h |
| 饼图/柱状图组件 | 开发科目分布、题型分布图表 | P0 | 3h |
| TOP榜单组件 | 开发热门试卷列表 | P0 | 2h |
| 数据刷新机制 | 实现自动/手动刷新功能 | P1 | 2h |
| 响应式适配 | 移动端适配优化 | P1 | 3h |
| 交互优化 | Loading状态、错误处理 | P2 | 2h |

**总计**: 22小时

---

## 七、测试计划

### 7.1 功能测试
- 各统计数据的准确性验证
- 图表展示的正确性验证
- 数据刷新功能测试
- 边界情况测试(无数据、大数据量)

### 7.2 性能测试
- 页面加载时间测试(目标: < 2秒)
- 并发访问压力测试
- 缓存命中率测试

### 7.3 兼容性测试
- 浏览器兼容性(Chrome、Firefox、Edge、Safari)
- 响应式布局测试(PC、平板、手机)

---

## 八、上线计划

### 8.1 上线步骤
1. 数据库执行索引优化脚本
2. 后端代码部署
3. 前端代码部署
4. 缓存预热(执行一次统计任务)
5. 功能验证
6. 正式发布

### 8.2 回滚方案
- 保留原首页备份
- 配置开关控制新旧首页切换
- 数据库DDL可逆

---

## 九、后续优化方向

### 9.1 功能增强
- 支持自定义统计时间范围
- 导出报表数据(Excel)
- 数据钻取(点击查看详情)
- 实时数据推送(WebSocket)

### 9.2 数据增强
- 用户画像分析
- 题目难度分析
- 知识点掌握度分析
- 学习路径推荐

### 9.3 交互优化
- 拖拽自定义布局
- 个性化配置(选择展示哪些统计模块)
- 主题切换(深色模式)

---

## 十、附录

### 10.1 相关文档
- 数据库表结构文档
- API接口文档
- 前端组件文档

### 10.2 参考资料
- ECharts官方文档: https://echarts.apache.org/
- Element UI官方文档: https://element.eleme.cn/

### 10.3 变更记录
| 日期 | 版本 | 修改人 | 修改内容 |
|------|------|--------|----------|
| 2025-11-22 | v1.0 | Cascade | 初始版本 |
