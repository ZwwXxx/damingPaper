# 前台个人学习报表规划文档

## 1. 项目背景

为提升学员在刷题平台的学习体验，提供面向个人的可视化学习数据报表，帮助学员了解自己的学习进度、掌握情况和薄弱点，从而制定更有效的学习策略。该报表将部署在 **daming-front** 前端项目中，服务于已登录的学员用户。

## 2. 用户画像与目标

- **用户角色**：平台普通学员（PC端）
- **核心诉求**：查看学习历史、掌握度、错题情况、学习习惯
- **使用场景**：
  1. 做题 / 考试后，希望回顾自己的近期表现
  2. 复习前，希望了解薄弱知识点和成长趋势
  3. 制定学习计划前，需要掌握学习时间分布

## 3. 数据大屏结构规划

### 3.1 整体布局
- 顶部：个人概览卡片（4张）
- 第一行：成绩趋势（折线图）+ 科目成绩对比（雷达图）
- 第二行：错题统计（饼图/柱状图组合）+ 收藏&复习进度
- 第三行：学习时间分布（热力图/柱状图）+ 最近考试记录列表
- 右侧抽屉：知识点掌握详情（可选优化）

### 3.2 模块明细

| 模块 | 指标/展示 | 数据来源 | 图表建议 |
|------|-----------|-----------|-----------|
| 学习概览卡片 | 累计做题数、累计考试次数、累计错题数、累计学习时长 | `daming_question_answer`、`daming_paper_answer`、`daming_question_favorite`、`sys_oper_log`（如需） | 数字卡片 + 同比/环比箭头 |
| 成绩趋势 | 最近10次考试成绩、及格线 | `daming_paper_answer` | 折线图 + 阈值线 |
| 科目成绩对比 | 各科目平均分、最高分、最低分 | `daming_paper_answer` + `daming_paper` + `daming_subject` | 雷达图 |
| 错题统计 | 错题总数、按科目分布、按题型分布、错题复习完成度 | `daming_question_answer` + `daming_question` + `daming_subject` | 饼图 + 条形图 + 进度条 |
| 收藏/复习进度 | 收藏题目数量、已复习数量、复习完成率 | `daming_question_favorite` + 复习计划表（如有） | 环形进度条 |
| 学习时间 | 最近30天学习天数、连续学习天数、每日时段分布 | `daming_question_answer` create_time / `daming_paper_answer` | 柱状图（24小时）+ 日历热力图（可选） |
| 最近考试记录 | 考试名称、日期、得分、用时、排名（如有） | `daming_paper_answer` + `daming_paper` | 表格 |
| 知识点掌握（可选） | 掌握/未掌握数量、掌握度趋势 | `daming_content_info`（知识点表，如缺则预留） | 进度条 + 折线图 |

### 3.3 权限要求
- 学员登录后即可访问
- 仅允许查看自己的数据，接口需基于 `user_id` 过滤

## 4. 后端实现规划

### 4.1 DTO 设计（包：`com.dm.quiz.dto.dashboard.front`）
- `PersonalOverviewDto`：做题数、考试数、错题数、学习时长、同比数据
- `ExamTrendDto`：考试名称、得分、满分、考试时间、耗时
- `SubjectScoreDto`：科目ID、科目名称、平均分、最高分、最低分、考试次数
- `WrongQuestionStatDto`：错题总数、按科目/题型分布列表
- `FavoriteReviewDto`：收藏数、已复习数、复习完成率
- `StudyTimeDistributionDto`：学习天数、连续天数、24小时分布、日历热力数据
- `RecentExamDto`：考试详情列表

### 4.2 Service 接口（`IPersonalDashboardService`）
- `PersonalOverviewDto getOverview(Long userId);`
- `List<ExamTrendDto> getExamTrend(Long userId, Integer limit);`
- `List<SubjectScoreDto> getSubjectScores(Long userId);`
- `WrongQuestionStatDto getWrongQuestionStat(Long userId);`
- `FavoriteReviewDto getFavoriteReviewStat(Long userId);`
- `StudyTimeDistributionDto getStudyTimeDistribution(Long userId, Integer days);`
- `List<RecentExamDto> getRecentExams(Long userId, Integer limit);`

### 4.3 Mapper 查询
- 新建 `PersonalDashboardMapper.xml`
- 需要的主要查询：
  - 题目答题记录统计（按用户）
  - 试卷答题记录统计（按用户）
  - 收藏 / 错题 / 复习进度表
  - 按科目聚合的统计查询
  - 24小时 + 最近30天查询使用 `DATE_FORMAT`

### 4.4 数据库索引建议
- `daming_question_answer`：(`user_id`, `create_time`), (`question_id`)
- `daming_paper_answer`：(`user_id`, `create_time`), (`paper_id`)
- `daming_question_favorite`：(`user_id`, `question_id`)
- 如需记录学习时长或复习进度，考虑新建表

## 5. 前端实现规划（daming-front）

### 5.1 菜单与路由
- 路由：`/dashboard/personal`
- 菜单：学习中心 -> 学习报表
- 组件结构：`views/dashboard/personal/index.vue`
- 子组件建议：
  - `PersonalOverviewCard.vue`
  - `ExamTrendChart.vue`
  - `SubjectRadar.vue`
  - `WrongQuestionChart.vue`
  - `StudyTimeChart.vue`
  - `RecentExamTable.vue`

### 5.2 图表库
- 使用 `ECharts`
- 组合方式：折线图 + 雷达图 + 饼图 + 环形图 + 柱状图 + 日历热力图（可选）

### 5.3 交互细节
- 考试趋势图：悬浮显示考试名称、分数、时间
- 科目雷达图：点击切换显示平均/最高/最低
- 错题统计：支持切换科目/题型
- 学习时间分布：支持按天/按小时切换
- 最近考试列表：支持跳转到考试解析页

## 6. 接口设计草稿

| 模块 | Method | URL | 描述 |
|------|--------|-----|------|
| 学习概览 | GET | `/api/personal/dashboard/overview` | 获取学习概览数据 |
| 成绩趋势 | GET | `/api/personal/dashboard/exam-trend?limit=10` | 最近考试成绩 |
| 科目对比 | GET | `/api/personal/dashboard/subject-score` | 各科目成绩对比 |
| 错题统计 | GET | `/api/personal/dashboard/wrong-question` | 错题分布 |
| 收藏复习 | GET | `/api/personal/dashboard/favorite-review` | 收藏与复习进度 |
| 学习时间 | GET | `/api/personal/dashboard/study-time?days=30` | 学习时间分布 |
| 最近考试 | GET | `/api/personal/dashboard/recent-exam?limit=10` | 最近考试列表 |

> 所有接口均需携带用户身份信息（Token），后端通过 `SecurityUtils.getUserId()` 获取当前用户。

## 7. 开发排期 (预估)

| 任务 | 预计工时 |
|------|----------|
| 需求规划、原型设计 | 2h |
| 后端 DTO / Mapper / Service / Controller | 6h |
| 前端页面与组件开发 | 8h |
| 联调与测试 | 3h |
| 文档与部署说明 | 1h |
| **合计** | **20h** |

## 8. 测试计划

- **功能测试**：
  - 登录用户访问报表
  - 各模块数据加载正常
  - 空数据/零数据场景展示占位
- **性能测试**：
  - 单用户接口响应时间 < 1s
  - 并发测试（100个请求）无明显性能下降
- **兼容性测试**：Chrome、Edge
- **安全性**：
  - 未登录访问需拦截
  - 仅能查看本人数据

## 9. 上线与运维

1. 执行索引脚本（如新增）
2. 后端部署：重新打包 `daming-admin`
3. 前端部署：构建 `daming-front`，发布静态资源
4. 权限配置：前端菜单 + 后端接口鉴权确认
5. 监控：接口日志、慢 SQL、错误日志

## 10. 后续优化方向
- 支持自定义时间范围（近7/30/90天）
- 支持导出报表（PDF/Excel）
- 增加学习提醒和目标设置
- 接入推送服务，在成绩波动时提醒学员
- 手机端自适应优化
