# 自动化部署说明 📚

为了解决每次手动打包部署的麻烦，提供以下自动化部署方案：

## 🚀 快速使用

### 1. 完整部署（推荐）
```bash
# Linux/Mac
./deploy.sh

# Windows  
deploy.bat
```

### 2. 快速重启（不重新打包）
```bash
./quick-restart.sh
```

### 3. 指定环境和服务器
```bash
# 部署到测试环境
./deploy.sh dev 192.168.1.100

# 部署到生产环境  
./deploy.sh prod 47.115.216.25
```

## 📋 脚本说明

### `deploy.sh` / `deploy.bat` - 完整自动化部署
- ✅ 自动本地打包
- ✅ 停止远程服务
- ✅ 备份旧版本
- ✅ 上传新版本
- ✅ 启动应用
- ✅ 健康检查

### `quick-restart.sh` - 快速重启
- 🔄 仅重启应用，不重新打包
- ⚡ 适用于服务器配置修改后的重启

## ⚙️ 配置说明

默认配置（可修改脚本中的变量）：
```bash
SERVER_IP="47.115.216.25"    # 服务器IP
SERVER_USER="root"           # SSH用户名
SERVER_PATH="/root/paper"    # 服务器部署路径
PROFILE="prod"               # 默认环境
```

## 🛠️ 初次使用准备

### 1. 确保SSH免密登录
```bash
# 生成SSH密钥（如果没有的话）
ssh-keygen -t rsa

# 复制公钥到服务器
ssh-copy-id root@47.115.216.25
```

### 2. 给脚本执行权限
```bash
chmod +x deploy.sh
chmod +x quick-restart.sh
```

### 3. 验证SSH连接
```bash
ssh root@47.115.216.25 "echo '连接成功'"
```

## 🎯 不同场景的使用建议

### 场景1：日常开发调试
- 修改代码后 → `./deploy.sh`
- 一键完成打包上传部署

### 场景2：配置文件修改
- 只修改了配置 → `./quick-restart.sh`
- 快速重启，节省时间

### 场景3：多环境部署
- 测试环境 → `./deploy.sh dev 测试服务器IP`
- 生产环境 → `./deploy.sh prod 生产服务器IP`

## 🔧 高级优化建议

### 1. 增量更新（进一步优化）
```bash
# 可以添加MD5检查，只有代码变更时才重新打包
# 检查本地jar包MD5与服务器是否一致
```

### 2. 多服务器部署
```bash
# 可以扩展脚本支持集群部署
# 同时部署到多台服务器
```

### 3. 回滚功能
```bash
# 利用备份文件快速回滚到上一版本
ssh root@47.115.216.25 "cd /root/paper && ./rollback.sh"
```

### 4. CI/CD集成
```yaml
# 可以集成到GitHub Actions或Jenkins
# 实现git push后自动部署
```

## 💡 使用技巧

1. **查看部署日志**：
   ```bash
   ssh root@47.115.216.25 "tail -f /root/paper/logs/application.log"
   ```

2. **远程调试应用**：
   ```bash
   ssh root@47.115.216.25 "cd /root/paper && jps | grep ruoyi"
   ```

3. **批量操作**：
   ```bash
   # 可以创建别名简化命令
   alias deploy='./deploy.sh prod'
   alias restart='./quick-restart.sh prod'
   ```

## 🆘 常见问题

### Q: SSH连接失败
**A**: 检查网络连接和SSH密钥配置

### Q: 权限不足
**A**: 检查脚本执行权限：`chmod +x *.sh`

### Q: 打包失败
**A**: 检查Maven配置和网络连接

### Q: 上传失败
**A**: 检查服务器磁盘空间和网络状况

---

现在你可以一键部署，告别手动操作的烦恼！ 🎉
